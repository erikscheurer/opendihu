\input{header.tex}

\graphicspath{
{images/png/}{images/}{images/plots/}
}


\begin{document}

%\setcounter{tocdepth}{2}
%\tableofcontents
%\newpage

\section{Laplace equation}
\label{chap:laplace}

For a computational domain $\Omega\subset \R^d$ the Laplace equation reads
\begin{equation}\label{eq:laplace}
  \begin{array}{ll}
    Δu = 0 \quad \text{on }\Omega.
  \end{array}
\end{equation}
A classical solution $u: \Omega \to \R$ fulfills \eqref{eq:laplace}. For a unique solution also boundary conditions have to be specified, e.g.
\begin{equation}
  \begin{array}{rcll}
    ∇u(\bfx) \cdot \bfn &=& 0 \quad &\text{on } \Gamma_N,\\[4mm]
    u(\bfx) &=& u_0(\bfx) \quad &\text{on } \Gamma_D,
  \end{array}
\end{equation}
where the homogeneous Neumann-type boundary conditions for $\bfx \in \Gamma_N$ set the flux over the boundary in normal direction $\bfn$ to zero and the Dirichlet-type boundary conditions on $\Gamma_D$ prescribe a value for $u$ on the boundary.

\subsection{Finite Element formulation}

By multiplication of a testfunction $\phi\in H^1_0(\Omega)$ and integration follows the weak formulation of \eqref{eq:laplace}:
\begin{equation}
  \begin{array}{ll}
    \ds\int_{\Omega}Δu\,\phi\,\d \bfx = 0 \quad \forall \phi\in H^1_0(\Omega)
  \end{array}
\end{equation}
For a definition of $H^1_0$ see section \ref{sec:hilbert}.

The Laplace operator can be written as $Δu=∇\cdot(∇u)$. Applying divergence theorem in form of \eqref{eq:gauss1} with $f=\phi$ and $\bfF=∇u$ yields
\begin{equation}
  \begin{array}{ll}
    -\ds\int_{\Omega}∇u \cdot ∇\phi \,\d \bfx + \ds\int_{\p \Omega} (\phi\,∇u)\cdot\bfn\,\d \bfx  = 0 \quad \forall \phi\in H^1_0(\Omega)
  \end{array}
\end{equation}
Because $\phi$ is zero on the boundary, the second term vanishes:
\begin{equation}\label{eq:laplace_weak}
  \begin{array}{ll}
    -\ds\int_{\Omega}∇u \cdot ∇\phi \,\d \bfx = 0 \quad \forall \phi\in H^1_0(\Omega)
  \end{array}
\end{equation}

Now we have to specify a finite-dimensional ansatz space to choose the solution function from. We do this by specifying a basis and take the span of it: $V:=\span\{\phi_1, \dots \phi_n\}$.

The numerical solution is given by
\begin{equation}
  \begin{array}{ll}
    u_h(\bfx) = \s{i=1}{N} u_i\,\phi_i(\bfx).
  \end{array}
\end{equation}
We also take $V$ as the space of testfunctions.
Plugging this into \eqref{eq:laplace_weak} yields
\begin{equation}\label{eq:laplace_discretized}
  \begin{array}{ll}
    -\s{i=1}{N} u_i \ds\int_{\Omega}∇\phi_i\cdot ∇\phi_j\,\d\bfx = 0 \quad \text{for }j=1,\dots,N.
  \end{array}
\end{equation}
The minus sign is kept for similarity with later mentioned problem equations that also have a right-hand side.

A reasonable choice of ansatz functions are functions that have limited support. We discretize the domain $\Omega$ by Finite Elements $\Omega_e$,
\begin{equation}
  \begin{array}{ll}
    \Omega = \overset{M}{\underset{e=1}{\bigcup}} \,\Omega_e = \Omega_1 \dot{\cup} \cdots \dot{\cup} \Omega_M,
  \end{array}
\end{equation} and define nodes with global indices $N(e)$ on each element $e$. Interpolating ansatz functions are now chosen such that they have the value 1 at only one node and the value 0 at all other nodes. The support is contained just within the elements that are adjacent to the node where the function is 1.

\subsection{Ansatz functions}
A simple choice that fulfills the requirements are first-order Lagrange functions $L_{i,p},p=1$ which are defined a follows for $d=1$ and depicted in \cref{fig:lagrange}.
\begin{equation}
  \begin{array}{ll}
    \varphi_i: [0,1] \to \R,\quad
    \varphi_1(x) = L_{1,1}(x) := 1-x, \qquad \varphi_2(x) = L_{2,1}(x) := x
  \end{array}
\end{equation}
For higher dimensions they are composed by a tensor product ansatz.
\begin{equation}
  \begin{array}{ll}
    \varphi_i(\bfx) = \bfL_{i}(\bfx) := \prod\limits_{k=1}^{d} L_{j,1}(x_k)
  \end{array}
\end{equation}
The local numbering of the ansatz functions of an element proceeds fastest in the first dimension then in the second and so on as shown in \cref{fig:element1}

\begin{figure}
  \centering
  \subfig{element1}{4cm}{Numbering and element coordinate system for a 2D first-order Lagrange element}\,
  \subfig{element2}{4.5cm}{Arbitrarily shaped element}
  \,
  \subfigpdf{lagrange}{6cm}{first order Lagrange ansatz functions}
  \caption{2D first-order Lagrange element}
  \label{fig:2d-lagrange}
\end{figure}

\subsection{Transformation of integration domain}
The definition of the ansatz functions was in parameter space, i.e. on the unit interval $[0,1]^d$. The corresponding coordinate system is $\bfxi = \{\xi_1, \dots \xi_d\}$. However, integration over the elements $\Omega_e$ of the computational domain is required. The node coordinates which define the elements are given in the global coordinate system $\bfx = \{x_1, \dots x_d\}$. A mapping from $\bfxi$ to $\bfx$ can be performed using multi-linear interpolation between the nodal coordinates $\bfx^i$:
\begin{equation}\label{eq:multilagrange}
  \begin{array}{ll}
    \bfx(\bfxi) = \Phi(\bfxi) := \ds\sum\limits_{i} \bfL_i(\bfxi)\,\bfx^i.
  \end{array}
\end{equation}
Note that again Lagrange functions of first order appear, but this is part of the parameter space to global space mapping and independent of the choosen ansatz functions. For 1D and 2D problems Eq.~\eqref{eq:multilagrange} can be written out as:
\begin{equation}\label{eq:fe_phi}
  \begin{array}{ll}
    \text{1D:}\quad
    \Phi(\xi_1) = (1-\xi_1)\,\bfx^1 + \xi_1\,\bfx^2\\[4mm]
    \text{2D:}\quad
    \Phi(\bfxi) = (1-\xi_1)\,(1-\xi_2)\,\bfx^1 + \xi_1\,(1-\xi_2)\,\bfx^2 + (1-\xi_1)\,\xi_2\,\bfx^3 + \xi_1\,\xi_2\,\bfx^4.
  \end{array}
\end{equation}
The node numbering and coordinate frames are defined by \cref{fig:element2}.
The Jacobians of $\Phi$ for the 1D and 2D case are as follows:
\begin{equation*}
  \begin{array}{lll}
    \text{1D:}\quad J_\Phi(\xi_1) = \Phi'(\xi_1) = \bfx^2-\bfx^1\\[4mm]
    \text{2D:}\quad J_\Phi(\bfxi) = \mat{(1-\xi_2)\,(
    \bfx^2-\bfx^1)+\xi_2\,(\bfx^4-\bfx^3) & (1-\xi_1)
    \,(\bfx^3-\bfx^1) +\xi_1\,(\bfx^4-\bfx^2)}
  \end{array}
\end{equation*}



Starting from \eqref{eq:laplace_discretized} we now plug in the Lagrange ansatz functions for $\phi$. Then the respective functions only have to be integrated over the elements where they are defined.
We get
\begin{equation}\label{eq:laplace_discretized0}
  \begin{array}{ll}
     -\s{e=1}{M} \sum_{i\in N(e)} u_i \ds\int_{\Omega_e} ∇\phi_i(\bfx)\cdot ∇\phi_j(\bfx)\,\d\bfx = 0 \quad \text{for }j=1,\dots,N,
  \end{array}
\end{equation}
where the sum over $i\in N(e)$ is over the nodes of element $e$. The expression $∇\phi(\bfx)$ means, that the gradient is with respect to $\bfx$, despite the function $\phi$ being defined in parameter space, i.e. ${∇\phi(\bfx) = ∇_\bfx \phi(\Phi^{-1}(\bfx)) = ∇_\bfx\phi(\bfxi)}$.

The integration domain, $\Omega_e$, is described by the mapping from parameter space, $\Omega_e = \Phi([0,1]^d)$.
At every point $\bfp = \Phi(\bfxi)$ the gradients are with respect to orthogonal coordinates in the tangent space of the point.
The tangent space coordinates for a particular point given by $\bfxi$ are introduced as $\bfzeta(\bfxi)=(\zeta_1(\bfxi), \dots, \zeta_d(\bfxi))$. The scaling is like in world space, i.e. the following holds:
\begin{equation*}
  \begin{array}{lll}
    \left|\p{\zeta_i}{\xi_i}\right| = \left|\p{\Phi}{\xi_i}\right|.
  \end{array}
\end{equation*}
The integral in \eqref{eq:laplace_discretized0} is then
\begin{equation}
  \begin{array}{ll}
     \ds\int_{\Omega_e} ∇\phi_i(\bfx)\cdot ∇\phi_j(\bfx)\,\d\bfx = 
     \ds\int_{\Phi([0,1]^d)} ∇_{\bfzeta(\bfxi(\bfx))}\phi_i(\bfx)\cdot ∇_{\bfzeta(\bfxi(\bfx))}\phi_j(\bfx)\,\d\bfx.
  \end{array}
\end{equation}
Depending on dimension this is resolved differently.

\textbf{1D case.} With one dimension, we can choose $\zeta_1 = \xi_1 \cdot s$, where $s$ is the scaling factor between the different length scales in world space ($\zeta$) and parameter space ($\xi$). Then with $\d\phi/\d\zeta = \d\phi/\d\xi\cdot \d\xi/\d\zeta$ and $\d\xi/\d\zeta = s^{-1}$ we get
\begin{equation*}
  \begin{array}{lll}
    \ds\int_{\Omega_e} ∇\phi_i(\bfx)\cdot ∇\phi_j(\bfx)\,\d\bfx = 
     \ds\int_{\Phi([0,1])} \d{\phi_i(\bfx)}{\xi} \d{\phi_j(\bfx)}{\xi}\Big(\ub{\d{\xi}{\zeta}}{=:s^{-1}}\Big)^2 \,\d\bfx.
  \end{array}
\end{equation*}
The scaling factor can be computed by 
\begin{equation*}
  \begin{array}{lll}
    \p{\Phi}{\xi} = \p{\zeta}{\xi} = s \quad \Rightarrow \quad s = \Phi'(\xi_1) = \Vert \bfx^2 - \bfx^1 \Vert_2.
  \end{array}
\end{equation*}
After transformation of the integration domain to parameter space this yields the following formula for the stiffness matrix:
\begin{equation*}
  \begin{array}{lll}
    \ds\int_{\Omega_e} ∇\phi_i(\bfx)\cdot ∇\phi_j(\bfx)\,\d\bfx = \ds\int_{[0,1]} \d{\phi_i(\xi)}{\xi} \d{\phi_j(\xi)}{\xi} s^{-2}\mathcal{J}_1(\xi)\,\d\xi
  \end{array}
\end{equation*}

\textbf{3D case.}
In 3D we use the world coordinate system as $\bfzeta$-frame, i.e. $\bfzeta_1 = \bfe_1, \bfzeta_2 = \bfe_2, \bfzeta_3 = \bfe_3$.
%
We transform the integration domain from global to local coordinate frame using  \eqref{eq:integration_transformation_dd} and get:
\begin{equation}\label{eq:fe_integral}
  \begin{array}{ll}
     -\s{e=1}{M} \sum_{i\in N(e)} u_i \ds\int_{[0,1]^d} ∇_{\bfzeta(\bfxi)}\phi_i(\bfxi)\cdot ∇_{\bfzeta(\bfxi)}\phi_j(\bfxi)\,\mathcal{J}_d(\bfxi)\,\d\bfxi = 0 \quad \text{for }j=1,\dots,N.
  \end{array}
\end{equation}
For a transformation of the gradients to parameter space we need the Jacobian $J_{\Phi}$ of the coordinate mapping, $\bfx =\Phi(\bfxi)$, which consists of the entries
\begin{equation*}
  \begin{array}{lll}
    \big(J_{\Phi}\big)_{i,j} = \d{x_i}{\xi_j}.
  \end{array}
\end{equation*}
Note that the Jacobian of $\Phi: \R^d \to \R^3$ might not be quadratic in general, but a $3 \times d$ matrix with $d \leq 3$. Only in the special 3D-case it is quadratic and can therefore be inverted.

Assuming that $\Phi$ is invertible on $\Omega$ the inverse function theorem states
\begin{equation*}
  \begin{array}{lll}
    J_{\Phi^{-1}} = J_\Phi^{-1}.
  \end{array}
\end{equation*}
%
Executing the chain rule on a derivative in world space, $\d \phi / \d x_k$, yields:
\begin{equation*}
  \begin{array}{lll}
    \d{\phi(\bfxi)}{x_k} = \s{\ell=1}{d}\d{\phi(\bfxi)}{\xi_\ell} \d{\xi_\ell(\bfxi)}{x_k}
  \end{array}
\end{equation*}
and for the whole gradient vector:
\begin{equation*}
  \begin{array}{lll}
    ∇_\bfx\phi(\bfxi) = J^{-\top}_\Phi(\bfxi) ∇_{\bfxi} \phi(\bfxi),
  \end{array}
\end{equation*}
where $J^{-\top}_\Phi = (J^{-1}_\Phi)^\top$.

Now the expression $∇_\bfx\phi_i\cdot ∇_\bfx\phi_j$ can be computed:
\begin{equation*}
  \begin{array}{lll}
    ∇_\bfx\phi_i(\bfx)\cdot ∇_\bfx\phi_j(\bfx) 
    &= \s{k=1}{d} \d{\phi_i(\bfxi)}{x_k}\d{\phi_j(\bfxi)}{x_k} 
    = \s{k=1}{d} \Big(\s{\ell=1}{d}\d{\phi_i(\bfxi)}{\xi_\ell} \d{\xi_\ell(\bfxi)}{x_k} \s{\ell=1}{d}\d{\phi_j(\bfxi)}{\xi_\ell} \d{\xi_\ell(\bfxi)}{x_k} \Big)\\[8mm]
    &= J^{-\top}_\Phi(\bfxi) ∇_{\bfxi} \phi_i(\bfxi) \cdot 
    J^{-\top}_\Phi(\bfxi) ∇_{\bfxi} \phi_j(\bfxi)\\[4mm]
    &= \big(J^{-\top}_\Phi(\bfxi) ∇_{\bfxi} \phi_i(\bfxi)\big)^\top 
    J^{-\top}_\Phi(\bfxi) ∇_{\bfxi} \phi_j(\bfxi)\\[4mm]
    &= ∇_{\bfxi} \phi_i(\bfxi)^\top \ub{J^{-1}_\Phi(\bfxi) 
    J^{-\top}_\Phi(\bfxi)}{=:T_\Phi(\bfxi)} ∇_{\bfxi} \phi_j(\bfxi).
  \end{array}
\end{equation*}
With the definition of the finite element Laplace operator  transformation matrix $T_\Phi(\bfxi) := J^{-1}_\Phi(\bfxi) 
    J^{-\top}_\Phi(\bfxi)$ the transformation becomes:
\begin{equation*}
  \begin{array}{lll}
    ∇_\bfx\phi_i(\bfx)\cdot ∇_\bfx\phi_j(\bfx) = ∇_{\bfxi} \phi_i(\bfxi) \cdot T_\Phi(\bfxi) ∇_{\bfxi} \phi_j(\bfxi).
  \end{array}
\end{equation*}

\textbf{2D case.}
In two dimensions we consider the 2D manifold embedded in $\R^3$ with the mapping $\Phi: [0,1]^2 \to \Omega \subset \R^3$. At a fixed point $\bfp \in \Omega$ with $\Phi(\bfxi_p) = \bfp$ we first determine the tangent vectors $\bfzeta_1(\bfxi_p), \bfzeta_2(\bfxi_z)$. The first tangent vector is defined to lie on the $\xi_1$ coordinate direction, the second vector is then constructed to be orthogonal to the first. To define the tangent vector $\bfzeta_1$ we use a curve in parameter space:
\begin{equation*}
  \begin{array}{lll}
    \gamma(t) = \mat{\gamma_1(t) \\ \gamma_2(t)} = \mat{\xi_{p1}+t \\ \xi_{p2} }.
  \end{array}
\end{equation*}
Then we define
\begin{equation*}
  \begin{array}{lll}
    \bfzeta_1 &= (\Phi \circ \gamma_1)'(0) 
    = \p{t}\Phi\big(\gamma(t)\big)|_{t=0} \\[4mm]
    &= \p{\Phi(\gamma(0))}{\xi_1}\ub{\gamma_1'(t)}{=1} + \p{\Phi(\gamma(0))}{\xi_2}\ub{\gamma_2'(t)}{=0}\\[4mm]
    &= \p{\Phi(\xi_p)}{\xi_1}.
  \end{array}
\end{equation*}
Similar we define the helper tangent vector $\bfzeta_h$ along the $\xi_2$ coordinate, which is then
\begin{equation*}
  \begin{array}{lll}
    \bfzeta_h = \p{\Phi(\xi_p)}{\xi_2}.
  \end{array}
\end{equation*}
$\bfzeta_1$ and $\bfzeta_h$ are not orthogonal in general. Therefore a third tangent vector $\bfzeta_2 = \bfzeta_1\times \bfzeta_h \times \bfzeta_1$ will be defined.

It is the tangent vector of a curve 
\begin{equation*}
  \begin{array}{lll}
    \delta(t) = \mat{\delta_1(t) \\ \delta_2(t)} = \mat{\xi_{p1}+\cos(α)t \\ \xi_{p2}+\sin(α)t }.
  \end{array}
\end{equation*}
The angle $\beta$ between $\bfzeta_1$ and $\bfzeta_h$ is given by
\begin{equation*}
  \begin{array}{lll}
    \cos(\beta) |\bfzeta_1| |\bfzeta_h| = \bfzeta_1 \cdot \bfzeta_h
    \quad \Rightarrow \quad \beta = \arccos\left(\dfrac{\bfzeta_1 \cdot \bfzeta_h}{|\bfzeta_1| |\bfzeta_h|}\right)
  \end{array}
\end{equation*}
Then by relating angles we get
\begin{equation*}
  \begin{array}{lll}
    \dfrac{\pi/2}{\beta} = \dfrac{α}{\pi/2} \quad \Rightarrow \quad \alpha = \dfrac{\pi^2}{4\,\beta}.
  \end{array}
\end{equation*}
So the tangent vector becomes
\begin{equation}\label{eq:tangent_vector}
  \begin{array}{lll}
    \bfzeta_2 = (\Phi \circ \delta)'(0) = \p{\Phi(\bfxi_p)}{\xi_1}\cos(α) + \p{\Phi(\bfxi_p)}{\xi_2}\sin(α) = \bfzeta_1\,\cos(α) + \bfzeta_h\,\sin(α).
  \end{array}
\end{equation}
Another approach is to use the formula 
\begin{equation*}
  \begin{array}{lll}
    \bfzeta_2 = \bfzeta_1\times \bfzeta_h \times \bfzeta_1,
  \end{array}
\end{equation*}
which leads to the expression
\begin{equation*}
  \begin{array}{lll}
    \bfzeta_2 = \mat{
    -\p{\Phi_2}{\xi_1}(\p{\Phi_1}{\xi_1}\p{\Phi_2}{\xi_2} - \p{\Phi_1}{\xi_2}\p{\Phi_2}{\xi_1}) - \p{\Phi_3}{\xi_1}(\p{\Phi_1}{\xi_1}\p{\Phi_3}{\xi_2} - \p{\Phi_1}{\xi_2}\p{\Phi_3}{\xi_1}) \\[4mm]
 \p{\Phi_1}{\xi_1}(\p{\Phi_1}{\xi_1}\p{\Phi_2}{\xi_2} - \p{\Phi_1}{\xi_2}\p{\Phi_2}{\xi_1}) - \p{\Phi_3}{\xi_1}(\p{\Phi_2}{\xi_1}\p{\Phi_3}{\xi_2} - \p{\Phi_2}{\xi_2}\p{\Phi_3}{\xi_1})\\[4mm]
 \p{\Phi_1}{\xi_1}(\p{\Phi_1}{\xi_1}\p{\Phi_3}{\xi_2} - \p{\Phi_1}{\xi_2}\p{\Phi_3}{\xi_1}) + \p{\Phi_2}{\xi_1}(\p{\Phi_2}{\xi_1}\p{\Phi_3}{\xi_2} - \p{\Phi_2}{\xi_2}\p{\Phi_3}{\xi_1})
    }.
  \end{array}
\end{equation*}
The mapping between parameter space and tangent space is given by $\Psi_\bfp$:
\begin{equation*}
  \begin{array}{lll}
    \Psi_\bfp : [0,1]^2 \to T_\bfp\Omega,\\[4mm]
    \Psi_\bfp(\bfxi) = \bfp + c_1(\bfxi)\,\hat{\bfzeta}_1 + c_2(\bfxi)\,\hat{\bfzeta}_2.\\[4mm]
  \end{array}
\end{equation*}
The basis vectors $\hat{\bfzeta}_i$ are the normalized tangent vectors, $\hat{\bfzeta}_i = \bfzeta_i / |\bfzeta_i|$. And the coefficients are:
\begin{equation*}
  \begin{array}{lll}
    c_1(\bfxi) = \big(\xi_1-\xi_{p1}-(\xi_2-\xi_{p2})\cos(α)/\sin(α)\big)\,l_1\\[4mm]
    c_2(\bfxi) = (\xi_2-\xi_{p2})/\sin(α)\,l_2,
  \end{array}
\end{equation*}
with the lengths $l_1 = |\bfzeta_1|, l_2 = |\bfzeta_2|$.

The Jacobian of $\Psi$ and its inverse are as follows:
\begin{equation*}
  \begin{array}{lll}
    J_\Psi = \mat{l_1 & -l_1\,\cos(α)/\sin(α) \\ 0 & l_2/\sin(α)},\qquad
    J_\Psi^{-1} = J_{\Psi^-1} = \mat{1/l_1 & \cos(α)/l_2 \\ 0 & \sin(α)/l_2}.
  \end{array}
\end{equation*}
The inverse contains the entries
\begin{equation*}
  \begin{array}{lll}
    (J^{-1}_{\Psi})_{i,j} = \d{\xi_i}{\zeta_j}.
  \end{array}
\end{equation*}

To compute the gradients of a function with respect to $\zeta$, we use the chain rule:
%
\begin{equation*}
  \begin{array}{lll}
    \d{\phi(\bfxi)}{\zeta_k} = \s{\ell=1}{d}\d{\phi(\bfxi)}{\xi_\ell}\d{\xi_\ell(\bfxi)}{\zeta_k},
  \end{array}
\end{equation*}
so the gradient becomes
\begin{equation*}
  \begin{array}{lll}
    ∇_{\bfzeta} \phi(\bfxi) = J_{\Psi}^{-\top}∇_{\bfxi}\phi(\bfxi),
  \end{array}
\end{equation*}
where $J^{-\top}_{\Psi} = (J_\Psi^{-1})^\top$.

Analogous to the 3D case we define 
\begin{equation*}
  \begin{array}{lll}
    T_\Psi(\bfxi) := J_{\Psi}^{-1}(\bfxi)J_\Psi^{-\top}(\bfxi) = \mat{\cos(α)^2/l_2^2 + 1/l_1^2 & \sin(α)\,\cos(α)/l_2^2 \\ \sin(α)\,\cos(α)/l_2^2 & \sin(α)^2/l_2^2}
  \end{array}
\end{equation*}
and get:
\begin{equation*}
  \begin{array}{lll}
    ∇_{\bfzeta}\phi_i(\bfx)\cdot ∇_{\bfzeta}\phi_j(\bfx) = ∇_{\bfxi} \phi_i(\bfxi) \cdot T_\Phi(\bfxi) ∇_{\bfxi} \phi_j(\bfxi).
  \end{array}
\end{equation*}
%Note that the computational domain $\Omega\subset \R^3$ is always considered to be embedded in $\R^3$. The 1D and 2D cases where the mesh is fully contained within a 1D or 2D subspace are then a specialization of the general case. Think of the lower dimensional meshes as a curve ($d=1$) or a bended surface ($d=2$) embedded in $\R^3$.

\subsection{Evaluation of the integral term}\label{chap:integral1}
The integral in \eqref{eq:fe_integral} defines for $i$ and $j$ the entries $m_{ij}$ of the \emph{stiffness matrix} $M$.
The equation can be written in matrix form as
%
\begin{equation*}
  \begin{array}{lll}
    M\,\bfu = \bfzero,
  \end{array}
\end{equation*}
where $M$ contains the entries
\begin{equation*}
  \begin{array}{lll}
    m_{ij} = -\ds\int_{\Omega}∇\phi_i\cdot ∇\phi_j\,\d\bfx = -\s{e=1}{M} \sum_{i\in N(e)} \ds\int_{[0,1]^d} ∇\phi_i(\bfxi)\cdot T_\Phi(\bfxi)∇\phi_j(\bfxi)\,\mathcal{J}_d(\bfxi)\,\d\bfxi
  \end{array}
\end{equation*}
and $\bfu = (u_1, \dots, u_N)^\top$ is the solution vector. Given $M$ the solution $\bfu$ is computed by an appropriate linear system solver.

The integral for $m_{i,j}$ depends via $\mathcal{J}_d$ on the shape of the elements. In general, it has to be evaluated numerically. However, for special simple cases it can be computed analytically.
This includes scenarios in $d=1,2,3$ dimensions where the elements are on a rectilinear cartesian grid.

If the grid is arbitrary, analytical computation for 1D is still simple. For $d=2,3$ it is still possible, but involves more lengthy derivations that are usually performed using a computer algebra system such as \verb|sympy|. In this section the 1D and 2D cases are derived, the python \verb|sympy| code for 2D and 3D is contained in the \verb|doc| directory for further reference.

For all 1D meshes that are embedded in a 3D domain as well as rectangular cartesian 2D and 3D meshes the terms $T_\Phi(\bfxi)$ and $\mathcal{J}_d(\bfxi)$ are constant within each element, i.e. do not depend on $\bfxi$. In that case we can take $\mathcal{J}_d$ out of the integral.

\textbf{1D case.}
We now compute $m_{ij}$ for $d=1$. The transformation term $\mathcal{J}_1(\xi)$
is defined as
%
\begin{equation*}
  \begin{array}{lll}
    \mathcal{J}_1(\xi) = \Vert \Phi'(\xi)\Vert_2.
  \end{array}
\end{equation*}
Using the parametric representation of $\Phi$ given in \eqref{eq:fe_phi}, we derive
%
\begin{equation*}
  \begin{array}{lll}
    \mathcal{J}_1(\xi) = \Vert \Phi'(\xi)\Vert_2 = \Vert \bfx^2 - \bfx^1 \Vert_2,
  \end{array}
\end{equation*}
which is the length of the element $e$ with nodes $\bfx^1$ and $\bfx^2$. We define it to be $l_e := \Vert\bfx^2-\bfx^1\Vert_2$, and thus have $\mathcal{J}_1(\xi) = l_e$. The scaling factor is then $s = l_e$ and the total prefactor of the integral becomes
\begin{equation*}
  \begin{array}{lll}
    \mathcal{J}_1\,s^{-2} = 1/l_e.
  \end{array}
\end{equation*}



%We use the derivatives of the Lagrange functions,
%\begin{equation}
%  \begin{array}{ll}
%    L_{1,1}'(\xi) = -1, \quad L_{2,1}'(\xi) = 1.\\[4mm]
%  \end{array}
%\end{equation}

\textbf{2D case.}
For 2D we assume a rectangular element that lies in a $z=\text{constant}$ plane with side lengths $l_{1,e}$ and $l_{2,e}$ in $\xi_1$ and $\xi_2$ directions.
The mapping from $\bfxi=(\xi_1,\xi_2)$ to $\bfx$ coordinate frame is given by
\begin{equation}
  \begin{array}{ll}
    \Phi(\bfxi) = \bfx^1 + \mat{\xi_1\,l_{1,e} \\[2mm] \xi_2\,l_{2,e}}.
  \end{array}
\end{equation}
Then we derive
\begin{equation*}
  \begin{array}{lll}
    J_{\Phi}(\bfxi) = \mat{l_{1,e}  & 0 \\[2mm] 0 & l_{2,e}}
  \end{array}
\end{equation*}
and
\begin{equation*}
  \begin{array}{lll}
    \mathcal{J}_2 = \sqrt{\det \big(J_{\Phi}(\bfxi)^\top J_{\Phi}(\bfxi)\big)} = |l_{1,e}\,l_{2,e}|.
  \end{array}
\end{equation*}
The tangent vectors $\bfzeta_1$ and $\bfzeta_h$ are computed to be
\begin{equation*}
  \begin{array}{lll}
    \bfzeta_1 = \p{\Phi(\bfxi_p)}{\xi_1} = (l_{1,e},0)^\top,\quad
    \bfzeta_h = \p{\Phi(\bfxi_p)}{\xi_2} = (0, l_{2,e})^\top,
     \quad l_1 = |\bfzeta_1| = l_{1,e}.
  \end{array}
\end{equation*}
The angle in between is
\begin{equation*}
  \begin{array}{lll}
    \beta = \arccos\left(\dfrac{\bfzeta_1\cdot \bfzeta_h}{|\bfzeta_1||\bfzeta_h|}\right) = \dfrac{\pi}{2}.
  \end{array}
\end{equation*}
The angle in parameter space is then also $\alpha = \pi^2 / (4\beta) = \pi/2$.
Using \eqref{eq:tangent_vector} the orthogonal tangent vector $\bfzeta_2$ becomes $\bfzeta_2 = \bfzeta_h$. Then $l_2 = |\bfzeta_h| = l_{2,e}$.

This leads to a transformation matrix
\begin{equation*}
  \begin{array}{lll}
    T_\Psi(\bfxi) = \mat{\cos(α)^2/l_2^2 + 1/l_1^2 & \sin(α)\,\cos(α)/l_2^2 \\[2mm] \sin(α)\,\cos(α)/l_2^2 & \sin(α)^2/l_2^2} = \mat{1/l_{1,e}^2 & 0 \\[2mm] 0 & 1/l_{2,e}^2}.
  \end{array}
\end{equation*}
When the mesh resolution is uniform, i.e. $l_{1,e} = l_{2,e} = l_e$, the transformation matrix becomes a scaled identity matrix, $T_{\Psi}(\bfxi) = l_e^{-2}\,\bfI$ and the transformation can be moved out of the integral. The prefactor is then
\begin{equation*}
  \begin{array}{lll}
    \mathcal{J}_2\,l_e^{-2} = 1.
  \end{array}
\end{equation*}


\textbf{3D case.}
Similar to the 2D case when a rectangular 3D grid with grid widths $l_{1,e}, l_{2,e},l_{3,e}$ is assumed, the transformation factor becomes
\begin{equation*}
  \begin{array}{lll}
    \mathcal{J}_3 = |l_{1,e}\,l_{2,e}\,l_{3,e}|.
  \end{array}
\end{equation*}
With the world mapping $\Phi(\bfxi)$ and its Jacobian $J_{\Phi}(\bfxi)$ given by
\begin{equation*}
  \begin{array}{lll}
    \Phi(\bfxi) = \bfx^1 + \mat{\xi_1\,l_{1,e}\\[2mm]
    \xi_2\,l_{2,e}\\[2mm]
    \xi_3\,l_{3,e}}
  \end{array}, \quad 
  J_{\Phi}(\bfxi) = \mat{l_{1,e}&0&0 \\[2mm] 0 & l_{2,e} & 0 \\[2mm] 0 & 0 & l_{3,e}},
\end{equation*}
the transformation matrix becomes
\begin{equation*}
  \begin{array}{lll}
    T_\Phi(\bfxi) := J^{-1}_\Phi(\bfxi) 
    J^{-\top}_\Phi(\bfxi) = \mat{l_{1,e}^{-2}&0&0 \\[2mm] 0 & l_{2,e}^{-2} & 0 \\[2mm] 0 & 0 & l_{3,e}^{-2}}.
  \end{array}
\end{equation*}
With uniform grid lengths, $l_{1,e}=l_{2,e}=l_{3,e}=l_e$, we get $T_\Phi(\bfxi) = l_e^{-2}\,\bfI$. The prefactor of the integral yields
\begin{equation*}
  \begin{array}{lll}
    \mathcal{J}_3\,l_e^{-2} = l_e.
  \end{array}
\end{equation*}

In the presented special cases with uniform grid resolution $\mathcal{J}_d$ did not depend on the integration domain, which allows to compute the factor separately:
\begin{equation*}
  \begin{array}{lll}
    \ds\int_{\Omega} ∇\phi_i \cdot T ∇\phi_j\,\mathcal{J}_d\,\d\bfxi = \mathcal{J}_d\,l_e^{-2}\ds\int_{\Omega} ∇\phi_i \cdot ∇\phi_j\,\d\bfxi.
  \end{array}
\end{equation*}

Now the term $-\int ∇\phi_i\cdot ∇\phi_j \,\d\xi$, remains to be computed. We compute values at the nodes and visualize them using \emph{stencil notation}. For a fixed node $i$ we compute the respective values for adjacent nodes $j$. The result for $i=j$ is underlined in the stencil, the values for adjacent nodes are placed left, right, top and bottom, in the position of the respective nodes.

We first compute element-wise stencils that state the contribution of a single element. If all elements have the same length properties, the element contributions can be summed up to get the total value at the nodes which is shown in the nodal stencils. From these stencils we can easily set up the stiffness matrix for a non-varying, equidistant mesh.

\begin{table}[h]
\centering
\begin{tabular}{l|l|l|l}
    dim & element contribution & node stencil\\
    \hline
    1D: &
\begin{minipage}{6cm}
  \begin{equation*}
     \left[\begin{array}{ccc}
        \underline{-1} & 1\\
    \end{array}\right] \quad 
  \end{equation*}
\end{minipage} 
    &
\begin{minipage}{6cm}
  \begin{equation*}
    \left[\begin{array}{ccc}
        1 & \underline{-2} & 1\\
    \end{array}\right]
  \end{equation*}
\end{minipage} 
     \\[4mm]
     \hline
    2D:&
\begin{minipage}{6cm}
  \begin{equation*}
    \left[
      \begin{array}{ccc}
        1/6 & 1/3 \\
        \underline{-2/3} & 1/6
      \end{array}
    \right]
  \end{equation*}
\end{minipage}  &
\begin{minipage}{6cm}
  \begin{equation*}
      \dfrac13\left[
        \begin{array}{ccc}
          1 & 1 & 1\\
          1 & \underline{-8} & 1 \\
          1 & 1 & 1
        \end{array}
      \right]
  \end{equation*}
\end{minipage}  \\[4mm]
    \hline
    3D: &
\begin{minipage}{6cm}
  \begin{equation*}
    \begin{array}{ll}
      \text{center:} &
      \left[\begin{array}{ccc}
          0 & 1/12\\
          \underline{-1/3} & 0\\
      \end{array}\right] \\[4mm]
      \text{top:}& 
      \left[\begin{array}{ccc}
          1/12 & 1/12\\
             0 & 1/12\\
      \end{array}\right]
    \end{array}
  \end{equation*}
\end{minipage} &
\begin{minipage}{6cm}
  \begin{equation*}
    \begin{array}{ll}
      \text{bottom:} &
      \dfrac1{12}
      \left[\begin{array}{ccc}
          1 & 2 & 1\\
          2 & 0 & 2\\
          1 & 2 & 1
      \end{array}\right] \\[4mm]
      \text{center:} &
      \dfrac1{12}
      \left[\begin{array}{ccc}
          2 & 0 & 2\\
          0 & \underline{-32} & 0\\
          2 & 0 & 2
      \end{array}\right] \\[4mm]
      \text{top:}& 
      \dfrac1{12}
      \left[\begin{array}{ccc}
          1 & 2 & 1\\
          2 & 0 & 2\\
          1 & 2 & 1 
      \end{array}\right]
    \end{array}  
  \end{equation*}
\end{minipage}
\end{tabular}
\caption{Stencils of the Finite Element stiffness matrix of $-Δu$ for an equidistant mesh with uniform resolution}
\end{table}

\subsection{Boundary Conditions}
\label{sec:bc}
The Dirichlet-type boundary condition
%
\begin{equation*}
  \begin{array}{lll}
    ∇u(\bfx)\cdot \bfn = 0 \qquad \text{on }\Gamma_N
  \end{array}
\end{equation*}
%
is satisfied automatically by the Galerkin finite element formulation. Starting from the left hand side of \eqref{eq:laplace_weak} and using Divergence theorem we get:
%
\begin{equation*}
  \begin{array}{lll}
    -\i{\Omega}{} ∇u\cdot ∇\phi \,\d \bfx = -\i{∂\Omega}{} \phi\,\big(∇u\cdot \bfn\big) \,\d \bfx + \i{\Omega}{} Δu\,\phi  \,\d \bfx = 0 \qquad ∀ \phi \in H^1_0(\Omega)
  \end{array}
\end{equation*}
%
Because $Δu = 0$ on $\Omega$ we get $∇u\cdot \bfn=0$ on the boundary.

Neumann boundary conditions can be easily considered at the discretized system. For each condition $u_i = u_{0,i}$ that enforces the degree of freedom $i$ to have the value $u_{0,i}$ we modify the linear system of equations. In the  right hand side vector we subtract from the value $f_{j}$ the product of $a_{ji}$ and the given value $u_{0,i}$ for every $j\neq i$, i.e. the new value is $\hat{f_j} = f_j - a_{ji}\,u_{0,i}$. We set $f_i = u_{0,i}$. In the matrix we zero the row and column that contain the entry $a_{ii}$, i.e. $a_{ij} = a_{ji} = 0, ∀j\neq i$ and set $a_{ii}=1$. As an example, consider the system
%
\begin{equation*}
  \begin{array}{lll}
    \mat{m_{11} & m_{12} & m_{13} \\ m_{21} & m_{22} & m_{23} \\ m_{31} & m_{32} & m_{33}}
    \mat{u_1 \\ u_2 \\ u_3} = \mat{0 \\ 0 \\ 0}
  \end{array}
\end{equation*}
with the Dirichlet boundary condition $u_3 = u_{0,3}$. The modified system then reads
%
\begin{equation*}
  \begin{array}{lll}
    \mat{m_{11} & m_{12} & 0 \\ m_{21} & m_{22} & 0 \\ 0 & 0 & 1}
    \mat{u_1 \\ u_2 \\ u_3} = \mat{-m_{13}\,u_{0,3} \\ -m_{23}\,u_{0,3} \\ u_{0,3}}.
  \end{array}
\end{equation*}

\subsection{Function spaces}
\label{sec:hilbert}
%
For the weak solutions $u$ of the problems we do not need to request $\CC^2(\Omega)$, since only the first derivatives are needed and only in a weak sense. Therefore $u\in H^1_0(\Omega)$ suffices.

The Hilbert space $H^1(\Omega)$ is the Sobolev space $\W^{1,2}(\Omega)$ which is defined using weak derivatives. The concept of weak derivatives generalizes the classical derivatives.

Let $u,v\in \Lloc(\Omega)$ and $\alpha \in \N^d_0$ a multi-index. Then $v$ is called \emph{weak derivative} of $u$ of order $\alpha$ iff
\begin{equation}
  \begin{array}{ll}
    \i{\Omega}{}u(\bfx) \D^\alpha \phi(\bfx) \,\d \bfx = (-1)^{|\alpha|} \i{\Omega}{} v(\bfx)\,\phi(\bfx)\,\d \bfx
  \end{array}
\end{equation}
for all $\phi \in \CC^\infty_0(\Omega)$. We then write $\D^\alpha u = v$. The derivative with the multi-index, $\D^\alpha$ is given by
\begin{equation}
  \begin{array}{ll}
    \D^\alpha = \dfrac{\p^{|\alpha|}}{\p^{\alpha_1}_{x_1} \cdots \p^{\alpha_d}_{x_d}}
  \end{array}
\end{equation}

If $u$ is differentable in a classical sense, the classical derivatives are also the weak derivatives. 

Now we define the \emph{Sobolev} space $\W^{1,2}(\Omega)$ (1=first order weak derivatives, 2=derivatives in $\L^2(\Omega)$)) as follows:
\begin{equation}
  \begin{array}{ll}
    \W^{1,2}(\Omega) := \{ u \in \Lloc(\Omega) \mid |\alpha| \in \N^d_0, |\alpha| \leq 1, \D^\alpha u \text{ exists}, \D^\alpha u \in \L^2(\Omega)\}.
  \end{array}
\end{equation}
With an appropriate Sobolev norm, $\W^{1,2}$ is a Banach space, i.e. complete (Cauchy series converge in it).

Together with the scalar product
\begin{equation}
  \begin{array}{ll}
    (u,v)_{H^1} := \sum\limits_{|\alpha|\leq 1} \i{\Omega}{}{\D^\alpha u(\bfx) \,\D^\alpha v(\bfx) \,\d\bfx}
  \end{array}
\end{equation}
we get the Hilbert space $H^1(\Omega) := \W^{1,2}(\Omega)$.

With $H^1_0(\Omega) := \{u \in H^1(\Omega) \mid u(\bfx) = 0 \text{ for } \bfx \in \p \Omega\}$ we denote the subspace of functions that are 0 on the boundary.

%-------------------------------------------------------------------------------------------------

\section{Poisson Equation}
The Poisson equation is a generalization of the Laplace equation and reads
%
\begin{equation*}
  \begin{array}{lll}
    Δu = f\qquad \text{on }\Omega.
  \end{array}
\end{equation*}
%
It can be subject to the same boundary conditions as Laplace equation, i.e. Neumann-type boundary conditions
%
\begin{equation*}
  \begin{array}{lll}
    ∇u(\bfx) \cdot \bfn = 0 \qquad \text{on }\Gamma_N,
  \end{array}
\end{equation*}
%
as well as Dirichlet-type boundary conditions
%
\begin{equation*}
  \begin{array}{lll}
    u(\bfx) = u_0(\bfx) \qquad \text{on }\Gamma_D.
  \end{array}
\end{equation*}
The finite element formulation proceeds similar to Chap.~\ref{chap:laplace}, multiplication of a testfunction $\phi \in H^{1}_0(\Omega)$ and integration yields
\begin{equation*}
  \begin{array}{lll}
    \ds\int_{\Omega}Δu\,\phi\,\d \bfx = \int_{\Omega} f\,\phi\,\d \bfx, \quad \forall \phi \in H^1_0(\Omega).
  \end{array}
\end{equation*}
Applying divergence theorem we get
\begin{equation*}
  \begin{array}{lll}
    -\ds\int_{\Omega} ∇u\cdot ∇\phi \,\d \bfx = \int_{\Omega} f\,\phi\,\d \bfx \quad \forall \phi \in H^{1}_0(\Omega).
  \end{array}
\end{equation*}
Like the solution $u(\bfx)$ also the right hand side $f(\bfx)$ has to be spatially discretized by a linear combination of coefficients and basis functions:
%
\begin{equation*}
  \begin{array}{lll}
    u_h(\bfx) = \s{i=1}{N}u_i\,\phi_i(\bfx),\\[4mm]
    f_h(\bfx) = \s{i=1}{N}f_i\,\phi_i(\bfx).
  \end{array}
\end{equation*}
By again choosing the space of testfunctions to be the same as the span of basis functions, ${V=\span\{\phi_1, \dots, \phi_n\}}$ we get the Galerkin formulation as
\begin{equation*}
  \begin{array}{lll}
    -\s{i=1}{N} u_i \int_\Omega ∇\phi_i\cdot ∇\phi_j \,\d\bfx = \s{i=1}{N}f_i \int_\Omega \phi_i\cdot \phi_j \,\d\bfx \quad \text{for }j = 1, \dots, N.
  \end{array}
\end{equation*}
The domain $\Omega$ is again decomposed into disjoint elements $\Omega_e, e=1,\dots, M$ and integration has only be performed over the elements where none of the basis function vanish.

The first integral term, $\int_{\Omega} ∇\phi_i\cdot ∇\phi_j\,\d\bfx$, has to be computed as described in Section \ref{chap:integral1}. How to compute the second integral term, $\int_{\Omega} \phi_i\cdot \phi_j\,\d\bfx$ is shown in the following.

Similar as before, the integration domain is transferred from element space to parameter space. For this a transformation factor $\mathcal{J}_d$ has to be considered, which is constant for some special cases as discussed in \cref{chap:integral1}.

For the remaining integral, $\int_{\Omega} \phi_i\cdot \phi_j\,\d\bfxi$ node stencils are provided in the following table.

\begin{table}[h]
\centering
\begin{tabular}{l|l|l|l}
    dim & element contribution & node stencil\\
    \hline
    1D: &
\begin{minipage}{6cm}
  \begin{equation*}
     \dfrac16\left[\begin{array}{ccc}
        \underline{2} & 1\\
    \end{array}\right] \quad 
  \end{equation*}
\end{minipage} 
    &
\begin{minipage}{6cm}
  \begin{equation*}
    \dfrac16\left[\begin{array}{ccc}
        1 & \underline{4} & 1\\
    \end{array}\right]
  \end{equation*}
\end{minipage} 
     \\[4mm]
     \hline
    2D:&
\begin{minipage}{6cm}
  \begin{equation*}
    \dfrac1{36}\left[\begin{array}{ccc}
        2 & 1 \\
        \underline{4} & 2
      \end{array}
    \right]
  \end{equation*}
\end{minipage}  &
\begin{minipage}{6cm}
  \begin{equation*}
      \dfrac1{36}\left[
        \begin{array}{ccc}
          1 & 4 & 1\\
          4 & \underline{16} & 4 \\
          1 & 4 & 1
        \end{array}
      \right]
  \end{equation*}
\end{minipage}  \\[4mm]
    \hline
    3D: &
\begin{minipage}{6cm}
  \begin{equation*}
    \begin{array}{ll}
      \text{center:} &
      \dfrac1{216}\left[\begin{array}{ccc}
          4 & 2\\
          \underline{8} & 4\\
      \end{array}\right] \\[4mm]
      \text{top:}& 
      \dfrac1{216}\left[\begin{array}{ccc}
          2 & 1\\
          4 & 2\\
      \end{array}\right]
    \end{array}
  \end{equation*}
\end{minipage} &
\begin{minipage}{6cm}
  \begin{equation*}
    \begin{array}{ll}
      \text{bottom:} &
      \dfrac1{216}\left[\begin{array}{ccc}
          1 & 4 & 1\\
          4 & 16 & 4\\
          1 & 4 & 1
      \end{array}\right] \\[4mm]
      \text{center:} &
      \dfrac1{216}
      \left[\begin{array}{ccc}
          4 & 16 & 4\\
          16 & \underline{64} & 16\\
          4 & 16 & 4
      \end{array}\right] \\[4mm]
      \text{top:}& 
      \dfrac1{216}
      \left[\begin{array}{ccc}
          1 & 4 & 1\\
          4 & 16 & 4\\
          1 & 4 & 1 
      \end{array}\right]
    \end{array}  
  \end{equation*}
\end{minipage}
\end{tabular}
\caption{Stencils of the Finite Element right hand side for an equidistant mesh with uniform resolution}
\end{table}


\section{Generalized Laplace operator}
%
The Laplace equation $Δu=0$ describes steady-state matter-/heat-/current flow where the computed quantity $u$ designates the potential that induces the flow $\bfF$, which can be modelled as being directed against the potential gradient, $\bfF = -∇u$. In terms of heat transfer this is \emph{Fick's law}. By considering the conservation law of the flowing quantity we assume $∇\cdot \bfF = 0$ which leads directly to the Laplace equation. 

If the medium in which the flow occurs is non-isotropic this can be modelled by adjusting the relationship between the negative potential gradient, $-∇u$, and the induced flow direction, $F$. By applying a linear map $A$ onto the negative gradient vector which can be thought of being the sum of contributions in coordinate directions, each contribution vector of a coordinate direction gets scaled and projected to a new direction. The flow is then $\bfF = -AΔu$ and the resulting equation is called generalized Laplace equation, reading
\begin{equation*}
  \begin{array}{lll}
    ∇\cdot (A ∇u) = 0.
  \end{array}
\end{equation*}
The parantheses can also be neglected. $∇\cdot A∇$ is referred to as generalized Laplace operator.

The derivation of the Finite Element formulation proceeds analoguos to \cref{chap:laplace}.
Multiplication with a testfunction $\phi$ yields:
\begin{equation}
  \begin{array}{ll}
    \ds\int_{\Omega}∇\cdot A ∇u\,\phi\,\d \bfx = 0 \quad \forall \phi\in H^1_0(\Omega)
  \end{array}
\end{equation}
Applying divergence theorem \eqref{eq:gauss1} with $f=\phi$ and $\bfF=A ∇u$ yields
\begin{equation}
  \begin{array}{ll}
    -\ds\int_{\Omega}A ∇u \cdot ∇\phi \,\d \bfx + \ds\int_{\p \Omega} (\phi\,A∇u)\cdot\bfn\,\d \bfx  = 0 \quad \forall \phi\in H^1_0(\Omega).
  \end{array}
\end{equation}
Because $\phi$ is zero on the boundary, the boundary integral vanishes:
\begin{equation}\label{eq:laplace_weak}
  \begin{array}{ll}
    -\ds\int_{\Omega}A ∇u \cdot ∇\phi \,\d \bfx = 0 \quad \forall \phi\in H^1_0(\Omega).
  \end{array}
\end{equation}
The discretization remains the same and leads to an integral term of
%
\begin{equation*}
  \begin{array}{lll}
    m_{ij} = -\ds\int_{Ω}A∇\phi_i\cdot ∇\phi_j\,\d\bfx.
  \end{array}
\end{equation*}
for the stiffness matrix $M$. For these term the stencil notation cannot be applied in general. The stiffness matrix has to be computed using e.g. numerical quadrature.

%------------------------------------------------------------------------------------------------
\section{Quadrature}

The aim is to compute a good approximation for the integral
%
\begin{equation*}
  \begin{array}{lll}
    I := \i{0}{1}f(\xi)\,\d \xi
  \end{array}
\end{equation*}
with a low number of function evaluations $f(\xi)$. 
\subsection{Gaussian quadrature}
The Gaussian quadrature rule approximates the integral by
%
\begin{equation*}
  \begin{array}{lll}
    I \approx \s{i=1}{n}f(\xi_i)\,w_i
  \end{array}
\end{equation*}
with appropriate \emph{Gauss points} $\xi_i$ and weights $w_i, i=1,\dots,n$. The sampling points and weights are chosen such that the rule approximates polynomials of degree $p_\text{exact}=2\,n-1$ exactly. Some values are listed below.

\begin{table}[ht]
\centering
\begin{tabular}{c|c|c|c}
    $n$& $\xi_i$& $w_i$ & $p_\text{exact}$\\[4mm]
    \hline&&\\[-4mm]
    $1$& $\dfrac12$ & $1$ & $1$\\[4mm]
    \hline
    $2$& $\pm \dfrac{1+\sqrt{3}}{2\sqrt{3}}$ & $\dfrac12$ & $3$\\[4mm]
    \hline
    $3$& $\dfrac12$ & $\dfrac49$ & $5$ \\[4mm]
     & $\pm \dfrac{\sqrt{3}+\sqrt{5}}{2\sqrt{5}}$ & $\dfrac{5}{18}$ &
\end{tabular}
\caption{Gauss points and weights}
\end{table}

Note: Literature on Gauss quadrature often describes the case of an integral $\int_{-1}^{1} f(x) \,\d x$. The transformation reads:
%
\begin{equation*}
  \begin{array}{lll}
    \i{0}{1} f(\xi) \,\d \xi = \dfrac12 \i{-1}{1} f\big(1/2+x/2\big) \,\d x.
  \end{array}
\end{equation*}

\subsection{Clenshaw-Curtis quadrature}
Clenshaw-Curtis quadrature approximates the function by a number of Chebyshev polynomials for which the exact integral is known.
The function $f$ is evaluated at the $n+1$ roots of the Chebyshev polynomial $T_{n+1}$, which are:
\begin{equation*}
  \begin{array}{lll}
    \xi_i = \cos(i\pi/n), \quad i = 0,\dots,n, \,n \text{ even}.
  \end{array}
\end{equation*}
The function can be written as Chebyshev series
%    
\begin{equation*}
  \begin{array}{lll}
    f(\xi) = \dfrac{a_0}{2} T_0(\xi) + \s{i=1}{∞} a_i\,T_i(x)
  \end{array}
\end{equation*}
where the coefficients result from discrete cosine transform. The approximated integral is computed by
\begin{equation*}
  \begin{array}{lll}
    I \approx a_0 + \s{i=1}{n/2-1} \dfrac{2\,a_{2\,i}}{1-(2\,i)^2} + \dfrac{a_n}{1-n^2}.
  \end{array}
\end{equation*}
The coefficients are
%
\begin{equation*}
  \begin{array}{lll}
    a_{2\,i} = \dfrac{2}{n}\Bigg(\dfrac{f(1)+f(-1)}{2} + f(0)\,(-1)^i + \s{i=1}{n/2-1}\big(f(\xi_i) + f(-\xi_i)\big)\cos(k/2\,\xi_i)\Bigg)
  \end{array}
\end{equation*}

This quadrature rule approximates polynomials with degree $p_\text{exact} = m-1$ exactly when using $m$ sampling points. However for some non-polynomial functions its accuracy may be better than the respective Gauss quadrature.

%------------------------------------------------------------------------------------------------
\section{Propositions}
In this section some propositions are collected such that they can be referenced when needed.

\subsection{Divergence theorem}
\textit{Also called Gauss's theorem.}
Let $U \subset \R^d$ be a compact set with a piecewise smooth boundary $\p U$, $\bfF: U \to \R^d$ a continuously differentiable vector field. Then:
\begin{equation}\label{eq:gauss}
  \begin{array}{ll}
    \ds\int_U ∇\cdot\bfF(\bfx) \,\d \bfx = \ds\int_{\p U} \bfF(\bfx)\cdot \bfn\,\d \bfx.
  \end{array}
\end{equation}
For $d=2$ one gets \emph{Stoke's theorem}.

\subsubsection{Corollary}
Replacing $\bfF$ of \eqref{eq:gauss} by ${f\,\bfF}$ yields the following proposition:

For a differentable function $f: U \to \R$ and a vector field $\bfF: U \to \R^d$ it holds:
\begin{equation}\label{eq:gauss1}
  \begin{array}{ll}
     \ds\int_U f(∇\cdot\bfF) \,\d \bfx = \ds\int_{\p U} (f\,\bfF)\cdot\bfn\,\d \bfx -\ds\int_U \bfF \cdot ∇f \,\d \bfx
  \end{array}
\end{equation}
Now set $\bfF\equiv (1,0,\dots), (0,1,\dots), \dots$ to get the following vector-valued identity:

For a differentable function $f: U \to \R$ it holds:
\begin{equation}
  \begin{array}{ll}
    \ds\int_U ∇f(\bfx) \,\d \bfx = \ds\int_{\p U} f(\bfx)\,\bfn\,\d \bfx
  \end{array}
\end{equation}

\subsection{Classical Stoke's theorem}
Let $U\subset \R^3$ be an open set, $V$ a 2-manifold in $U$ with boundary $\p V$ and $\bfF: U \to \R^3$ a continuously differentiable vector field. Then:
\begin{equation}
  \begin{array}{ll}
    \ds\varointctrclockwise_{\p V} \bfF\cdot\d s = \ds\int_{V} \big(∇\times \bfF\big) \cdot \bfn \,\d\bfx,
  \end{array}
\end{equation}
where $\bfn$ is the normal on the surface $V$.

\subsection{Integration on manifolds}
In the following it is outlined how to integrate on 1D and 2D domains that are embedded in $\R^d$. The formalism of manifolds is omitted for simplicity.

\subsubsection{1D curve integrals}
Let $U\subset \R$ be an open set (the parameter space) and $\Phi:U \to \R^d$ a smooth mapping that defines a curve $\Omega=\Phi(U)$ embedded in $\R^d$. An integrable function $g:\Omega \to \R$ can then be integrated as follows:
%
\begin{equation}\label{eq:integration_transformation_1d}
  \begin{array}{ll}
    \ds\int_{\Phi(U)} g(\bfx) \,\d\bfx = \int_{U} g\big(\Phi(\xi)\big)\,\Vert \Phi'(\xi)\Vert_2 \, \d \xi
  \end{array}
\end{equation}


\subsubsection{2D surface integrals}
Let $U \subset \R^2$ be an open set (parameter space), $\Phi:U \to \Phi(U)=:\Omega \subset\R^3$ a diffeomorphism, $\Phi$ maps parameters $\bfxi=(\xi_1,\xi_2) \in U$ to points in world space $\bfx \in \Omega$. The inverse map $\Phi^{-1} : \Omega \subset \R^3 \to \R^2$ assigns coordinates $(\xi_1,\xi_2)$ to each point $\bfx\in\Omega$. We name $\Phi^{-1}(\bfx) = (x(\bfx),y(\bfx))$ in the following formula. The integration of a 2-dimensional function $g:\Omega \to \R$ is performed as follows.
%
\begin{equation}\label{eq:integration_transformation_2d}
  \begin{array}{ll}
    \ds\int_{\Phi(U)} g(\bfx) \,\d\bfx  
    &  = \ds\int_{U} g\big(\Phi(\bfxi)\big) 
    \sqrt{\det \big(J_{\Phi}(\bfxi)^\top J_{\Phi}(\bfxi)\big)}\,\d\bfxi\\[4mm]
    
    & = \ds\int_{U} g\big(\Phi(\bfxi)\big) 
    \sqrt{\det\mat{\d{\Phi}{\xi_1} \cdot \d{\Phi}{\xi_1} & \d{\Phi}{\xi_1} \cdot \d{\Phi}{\xi_2}  \\[4mm]
    \d{\Phi}{\xi_1} \cdot \d{\Phi}{\xi_2} & \d{\Phi}{\xi_2} \cdot \d{\Phi}{\xi_2}}}\,\d\bfxi\\[4mm]
    
     & = \ds\int_{U} g\big(\Phi(\bfxi)\big) 
    \sqrt{\Big\Vert \d{\Phi}{\xi_1}\Big\Vert_2^2\,\Big\Vert \d{\Phi}{\xi_2}\Big\Vert_2^2 - \Big(\d{\Phi}{\xi_1} \cdot \d{\Phi}{\xi_2}\Big)^2 }\,\d\bfxi\\[4mm]
    
    
  \end{array}
\end{equation}

\subsubsection{Substitution on domains with same dimensionality}
\emph{Integration by substitution}, \textit{German \say{Transformationssatz}}, also \emph{change of variables rule}.
Let $U \subset \R^d$ be an open set, $\Phi:U \to \Phi(U) \subset\R^d$ a diffeomorphism ($\Phi$ bijective and continuously differentiable, inverse map $\Phi^{-1}$ also continuously differentiable).

Then $g:\Phi(U) \to \R$ is integrable on $\Phi(U)$ if and only if the function $\bfxi \mapsto g(\Phi(\bfxi))\,|\det(J_{\Phi}(\bfxi))|$ is integrable on $U$. It holds:
\begin{equation}\label{eq:integration_transformation_3d}
  \begin{array}{ll}
    \ds\int_{\Phi(U)} g(\bfx)\,\d \bfx = \ds\int_U g(\Phi(\bfxi))\,|\det(J_{\Phi}(\bfxi))|\,\d \bfxi,
  \end{array}
\end{equation}
where $J_{\Phi}$ is the Jacobian of $\Phi$.

\subsubsection{Summary}
The transformation rules \cref{eq:integration_transformation_1d,eq:integration_transformation_2d,eq:integration_transformation_3d} can be summarized in a unified form as follows.

Let $U \subset \R^d, d\in\{1,2,3\}$ be an open set (parameter space), $\Phi:U \to \Phi(U)=:\Omega \subset\R^d$ a diffeomorphism that maps parameters $\bfxi \in U$ to points in world space $\bfx \in \Omega$. A function defined in parameter space, $f:U\to \R$, can then be integrated as follows in world space.
%
\begin{equation}\label{eq:integration_transformation_dd}
  \begin{array}{lll}
    \ds\int_{\Phi(U)} f\big(\Phi^{-1}(\bfx)\big)\,\d \bfx = \ds\int_U f(\bfxi)\,\mathcal{J}_d(\bfxi)\,\d \bfxi,
  \end{array}
\end{equation}
where the definition of $\mathcal{J}_d(\bfxi)$  depends on the dimension $d$ as follows:
%
\begin{equation*}
  \begin{array}{rll}
    \mathcal{J}_1(\xi) &= \Vert \Phi'(\xi) \Vert_2 &\quad \text{for }d=1, \bfxi=\xi \in U \subset \R,\\[4mm]
    \mathcal{J}_2(\bfxi) &= \sqrt{\det \big(J_{\Phi}(\bfxi)^\top J_{\Phi}(\bfxi)\big)} &\quad \text{for }d=2, \bfxi\in U \subset \R^2, \phi^{-1}(\bfx) =: \big(x(\bfx), y(\bfx)\big),\\[4mm]
    \mathcal{J}_3(\bfxi) &= |\det (J_{\Phi}\big(\bfxi)\big)| &\quad \text{for }d=3, \bfxi\in U \subset \R^3.
  \end{array}
\end{equation*}

% -------------- Literaturseite --------------------
%\newpage
%\bibliography{literatur}{}
%\bibliographystyle{abbrv}

% -------------- Anhang ------------
%\appendix
%\input{8_anhang.tex}

\end{document}
