\input{header.tex}

\graphicspath{
{images/png/}{images/}{images/plots/}
}


\begin{document}

\setcounter{tocdepth}{2}
\tableofcontents
\newpage

\section{Laplace equation}
\label{chap:laplace}

For a computational domain $\Omega\subset \R^d$ the Laplace equation reads
\begin{equation}\label{eq:laplace}
  \begin{array}{ll}
    Δu = 0 \quad \text{on }\Omega.
  \end{array}
\end{equation}
A classical solution $u: \Omega \to \R$ fulfills \eqref{eq:laplace}. For a unique solution also boundary conditions have to be specified, e.g.
\begin{equation}
  \begin{array}{rcll}
    ∇u(\bfx) \cdot \bfn &=& 0 \quad &\text{on } \Gamma_N,\\[4mm]
    u(\bfx) &=& u_0(\bfx) \quad &\text{on } \Gamma_D,
  \end{array}
\end{equation}
where the homogeneous Neumann-type boundary conditions for $\bfx \in \Gamma_N$ set the flux over the boundary in normal direction $\bfn$ to zero and the Dirichlet-type boundary conditions on $\Gamma_D$ prescribe a value for $u$ on the boundary.

\subsection{Finite Element formulation}

By multiplication of a testfunction $\phi\in H^1_0(\Omega)$ and integration follows the weak formulation of \eqref{eq:laplace}:
\begin{equation}
  \begin{array}{ll}
    \ds\int_{\Omega}Δu\,\phi\,\d \bfx = 0 \quad \forall \phi\in H^1_0(\Omega)
  \end{array}
\end{equation}
For a definition of $H^1_0$ see section \ref{sec:hilbert}.

The Laplace operator can be written as $Δu=∇\cdot(∇u)$. Applying divergence theorem in form of \eqref{eq:gauss1} with $f=\phi$ and $\bfF=∇u$ yields
\begin{equation}
  \begin{array}{ll}
    -\ds\int_{\Omega}∇u \cdot ∇\phi \,\d \bfx + \ds\int_{\p \Omega} (\phi\,∇u)\cdot\bfn\,\d \bfx  = 0 \quad \forall \phi\in H^1_0(\Omega)
  \end{array}
\end{equation}
Because $\phi$ is zero on the boundary, the second term vanishes:
\begin{equation}\label{eq:laplace_weak}
  \begin{array}{ll}
    -\ds\int_{\Omega}∇u \cdot ∇\phi \,\d \bfx = 0 \quad \forall \phi\in H^1_0(\Omega)
  \end{array}
\end{equation}

Now we have to specify a finite-dimensional ansatz space to choose the solution function from. We do this by specifying a basis and take the span of it: $V:=\span\{\phi_1, \dots \phi_n\}$.

The numerical solution is given by
\begin{equation}
  \begin{array}{ll}
    u_h(\bfx) = \s{i=1}{N} u_i\,\phi_i(\bfx).
  \end{array}
\end{equation}
We also take $V$ as the space of testfunctions.
Plugging this into \eqref{eq:laplace_weak} yields
\begin{equation}\label{eq:laplace_discretized}
  \begin{array}{ll}
    -\s{i=1}{N} u_i \ds\int_{\Omega}∇\phi_i\cdot ∇\phi_j\,\d\bfx = 0 \quad \text{for }j=1,\dots,N.
  \end{array}
\end{equation}
The minus sign is kept for similarity with later mentioned problem equations that also have a right-hand side.

A reasonable choice of ansatz functions are functions that have limited support. We discretize the domain $\Omega$ by Finite Elements $\Omega_e$,
\begin{equation}
  \begin{array}{ll}
    \Omega = \overset{M}{\underset{e=1}{\bigcup}} \,\Omega_e = \Omega_1 \dot{\cup} \cdots \dot{\cup} \Omega_M,
  \end{array}
\end{equation} and define nodes with global indices $N(e)$ on each element $e$. Interpolating ansatz functions are now chosen such that they have the value 1 at only one node and the value 0 at all other nodes. The support is contained just within the elements that are adjacent to the node where the function is 1.

\subsection{Ansatz functions}
A simple choice that fulfills the requirements are first-order Lagrange functions $L_{i,p},p=1$ which are defined a follows for $d=1$ and depicted in \cref{fig:lagrange}.
\begin{equation}
  \begin{array}{ll}
    \varphi_i: [0,1] \to \R,\quad
    \varphi_1(x) = L_{1,1}(x) := 1-x, \qquad \varphi_2(x) = L_{2,1}(x) := x
  \end{array}
\end{equation}
For higher dimensions they are composed by a tensor product ansatz.
\begin{equation}
  \begin{array}{ll}
    \varphi_i(\bfx) = \bfL_{i}(\bfx) := \prod\limits_{k=1}^{d} L_{j,1}(x_k)
  \end{array}
\end{equation}
The local numbering of the ansatz functions of an element proceeds fastest in the first dimension then in the second and so on as shown in \cref{fig:element1}

\begin{figure}
  \centering
  \subfig{element1}{4cm}{Numbering and element coordinate system for a 2D first-order Lagrange element}\,
  \subfig{element2}{4.5cm}{Arbitrarily shaped element}
  \,
  \subfigpdf{lagrange}{6cm}{first order Lagrange ansatz functions}
  \caption{2D first-order Lagrange element}
  \label{fig:2d-lagrange}
\end{figure}

\subsection{Transformation of integration domain}
The definition of the ansatz functions was in parameter space, i.e. on the unit interval $[0,1]^d$. The corresponding coordinate system is $\bfxi = \{\xi_1, \dots \xi_d\}$. However, integration over the elements $\Omega_e$ of the computational domain is required. The node coordinates which define the elements are given in the global coordinate system $\bfx = \{x_1, \dots x_d\}$. A mapping from $\bfxi$ to $\bfx$ can be performed using multi-linear interpolation between the nodal coordinates $\bfx^i$:
\begin{equation}\label{eq:multilagrange}
  \begin{array}{ll}
    \bfx(\bfxi) = \Phi(\bfxi) := \ds\sum\limits_{i} \bfL_i(\bfxi)\,\bfx^i.
  \end{array}
\end{equation}
Note that again Lagrange functions of first order appear, but this is part of the parameter space to global space mapping and independent of the choosen ansatz functions. For 1D and 2D problems Eq.~\eqref{eq:multilagrange} can be written out as:
\begin{equation}\label{eq:fe_phi}
  \begin{array}{ll}
    \text{1D:}\quad
    \Phi(\xi_1) =& (1-\xi_1)\,\bfx^1 + \xi_1\,\bfx^2\\[4mm]
    \text{2D:}\quad
    \Phi(\bfxi) =& (1-\xi_1)\,(1-\xi_2)\,\bfx^1 + \xi_1\,(1-\xi_2)\,\bfx^2 + (1-\xi_1)\,\xi_2\,\bfx^3 + \xi_1\,\xi_2\,\bfx^4.\\[4mm]
    \text{3D:}\quad
    \Phi(\bfxi) =& 
      (1-\xi_1)\,(1-\xi_2)\,(1-\xi_3)\,\bfx^1 + \xi_1\,(1-\xi_2)\,(1-\xi_3)\,\bfx^2 + (1-\xi_1)\,\xi_2\,(1-\xi_3)\,\bfx^3 + \xi_1\,\xi_2\,(1-\xi_3)\,\bfx^4\\[4mm]
      &+ (1-\xi_1)\,(1-\xi_2)\,\xi_3\,\bfx^5 + \xi_1\,(1-\xi_2)\,\xi_3\,\bfx^6 + (1-\xi_1)\,\xi_2\,\xi_3\,\bfx^7 + \xi_1\,\xi_2\,\xi_3\,\bfx^8
    
  \end{array}
\end{equation}
The node numbering and coordinate frames are defined by \cref{fig:element2}.
The Jacobians of $\Phi$ for the 1D and 2D case are as follows:
\begin{equation*}
  \begin{array}{lll}
    \text{1D:}\quad &J_\Phi(\xi_1) = \Phi'(\xi_1) = \bfx^2-\bfx^1\\[4mm]
    \text{2D:}\quad &J_\Phi(\bfxi) = \mat{(1-\xi_2)\,(
    \bfx^2-\bfx^1)+\xi_2\,(\bfx^4-\bfx^3) & (1-\xi_1)
    \,(\bfx^3-\bfx^1) +\xi_1\,(\bfx^4-\bfx^2)}\\[4mm]
    \text{3D:}\quad &J_\Phi(\bfxi) = \mat{J_{\Phi,1}(\bfxi) & J_{\Phi,2}(\bfxi) & J_{\Phi,3}(\bfxi)}\\[4mm]
    & J_{\Phi,1}(\bfxi) =
     (1-\xi_2)\,(1-\xi_3)\,(\bfx^2-\bfx^1)
     +\xi_2\,(1-\xi_3)\,(\bfx^4-\bfx^3)
     +(1-\xi_2)\,\xi_3\,(\bfx^6-\bfx^5)
     +\xi_2\,\xi_3\,(\bfx^8-\bfx^7) \\[4mm]
    & J_{\Phi,2}(\bfxi) =
     (1-\xi_1)\,(1-\xi_3)\,(\bfx^3 -\bfx^1)
     + \xi_1\,(1-\xi_3)\,(\bfx^4-\bfx^2)
     + (1-\xi_1)\,\xi_3\,(\bfx^7-\bfx^5)
     + \xi_1\,\xi_3\,(\bfx^8-\bfx^6) \\[4mm]
    & J_{\Phi,3}(\bfxi) =
     (1-\xi_1)\,(1-\xi_2)\,(\bfx^5 -\bfx^1)
     + \xi_1\,(1-\xi_2)\,(\bfx^6-\bfx^2)
     + (1-\xi_1)\,\xi_2\,(\bfx^7-\bfx^3)
     + \xi_1\,\xi_2\,(\bfx^8-\bfx^4)
    
  \end{array}
\end{equation*}



Starting from \eqref{eq:laplace_discretized} we now plug in the Lagrange ansatz functions for $\phi$. Then the respective functions only have to be integrated over the elements where they are defined.
We get
\begin{equation}\label{eq:laplace_discretized0}
  \begin{array}{ll}
     -\s{e=1}{M} \sum_{i\in N(e)} u_i \ds\int_{\Omega_e} ∇\phi_i(\bfx)\cdot ∇\phi_j(\bfx)\,\d\bfx = 0 \quad \text{for }j=1,\dots,N,
  \end{array}
\end{equation}
where the sum over $i\in N(e)$ is over the nodes of element $e$. The expression $∇\phi(\bfx)$ means, that the gradient is with respect to $\bfx$, despite the function $\phi$ being defined in parameter space, i.e. ${∇\phi(\bfx) = ∇_\bfx \phi(\Phi^{-1}(\bfx)) = ∇_\bfx\phi(\bfxi)}$.

The integration domain, $\Omega_e$, is described by the mapping from parameter space, $\Omega_e = \Phi([0,1]^d)$.
At every point $\bfp = \Phi(\bfxi)$ the gradients are with respect to orthogonal coordinates in the tangent space of the point.
The tangent space coordinates for a particular point given by $\bfxi$ are introduced as $\bfzeta(\bfxi)=(\zeta_1(\bfxi), \dots, \zeta_d(\bfxi))$. The scaling is like in world space, i.e. the following holds:
\begin{equation*}
  \begin{array}{lll}
    \left|\p{\zeta_i}{\xi_i}\right| = \left|\p{\Phi}{\xi_i}\right|.
  \end{array}
\end{equation*}
The integral in \eqref{eq:laplace_discretized0} is then
\begin{equation}
  \begin{array}{ll}
     \ds\int_{\Omega_e} ∇\phi_i(\bfx)\cdot ∇\phi_j(\bfx)\,\d\bfx = 
     \ds\int_{\Phi([0,1]^d)} ∇_{\bfzeta(\bfxi(\bfx))}\phi_i(\bfx)\cdot ∇_{\bfzeta(\bfxi(\bfx))}\phi_j(\bfx)\,\d\bfx.
  \end{array}
\end{equation}
Depending on dimension this is resolved differently.

\textbf{1D case.} With one dimension, we can choose $\zeta_1 = \xi_1 \cdot s$, where $s$ is the scaling factor between the different length scales in world space ($\zeta$) and parameter space ($\xi$). Then with $\d\phi/\d\zeta = \d\phi/\d\xi\cdot \d\xi/\d\zeta$ and $\d\xi/\d\zeta = s^{-1}$ we get
\begin{equation*}
  \begin{array}{lll}
    \ds\int_{\Omega_e} ∇\phi_i(\bfx)\cdot ∇\phi_j(\bfx)\,\d\bfx = 
     \ds\int_{\Phi([0,1])} \d{\phi_i(\bfx)}{\xi} \d{\phi_j(\bfx)}{\xi}\Big(\ub{\d{\xi}{\zeta}}{=:s^{-1}}\Big)^2 \,\d\bfx.
  \end{array}
\end{equation*}
The scaling factor can be computed by 
\begin{equation*}
  \begin{array}{lll}
    \p{\Phi}{\xi} = \p{\zeta}{\xi} = s \quad \Rightarrow \quad s = \Phi'(\xi_1) = \Vert \bfx^2 - \bfx^1 \Vert_2.
  \end{array}
\end{equation*}
After transformation of the integration domain to parameter space this yields the following formula for the stiffness matrix:
\begin{equation*}
  \begin{array}{lll}
    \ds\int_{\Omega_e} ∇\phi_i(\bfx)\cdot ∇\phi_j(\bfx)\,\d\bfx = \ds\int_{[0,1]} \d{\phi_i(\xi)}{\xi} \d{\phi_j(\xi)}{\xi} s^{-2}\mathcal{J}_1(\xi)\,\d\xi
  \end{array}
\end{equation*}

\textbf{3D case.}
In 3D we use the world coordinate system as $\bfzeta$-frame, i.e. $\bfzeta_1 = \bfe_1, \bfzeta_2 = \bfe_2, \bfzeta_3 = \bfe_3$.
%
We transform the integration domain from global to local coordinate frame using  \eqref{eq:integration_transformation_dd} and get:
\begin{equation}\label{eq:fe_integral}
  \begin{array}{ll}
     -\s{e=1}{M} \sum_{i\in N(e)} u_i \ds\int_{[0,1]^d} ∇_{\bfzeta(\bfxi)}\phi_i(\bfxi)\cdot ∇_{\bfzeta(\bfxi)}\phi_j(\bfxi)\,\mathcal{J}_d(\bfxi)\,\d\bfxi = 0 \quad \text{for }j=1,\dots,N.
  \end{array}
\end{equation}
For a transformation of the gradients to parameter space we need the Jacobian $J_{\Phi}$ of the coordinate mapping, $\bfx =\Phi(\bfxi)$, which consists of the entries
\begin{equation*}
  \begin{array}{lll}
    \big(J_{\Phi}\big)_{i,j} = \d{x_i}{\xi_j}.
  \end{array}
\end{equation*}
Note that the Jacobian of $\Phi: \R^d \to \R^3$ might not be quadratic in general, but a $3 \times d$ matrix with $d \leq 3$. Only in the special 3D-case it is quadratic and can therefore be inverted.

Assuming that $\Phi$ is invertible on $\Omega$ the inverse function theorem states
\begin{equation*}
  \begin{array}{lll}
    J_{\Phi^{-1}} = J_\Phi^{-1}.
  \end{array}
\end{equation*}
%
Executing the chain rule on a derivative in world space, $\d \phi / \d x_k$, yields:
\begin{equation*}
  \begin{array}{lll}
    \d{\phi(\bfxi)}{x_k} = \s{\ell=1}{d}\d{\phi(\bfxi)}{\xi_\ell} \d{\xi_\ell(\bfxi)}{x_k}
  \end{array}
\end{equation*}
and for the whole gradient vector:
\begin{equation*}
  \begin{array}{lll}
    ∇_\bfx\phi(\bfxi) = J^{-\top}_\Phi(\bfxi) ∇_{\bfxi} \phi(\bfxi),
  \end{array}
\end{equation*}
where $J^{-\top}_\Phi = (J^{-1}_\Phi)^\top$.

Now the expression $∇_\bfx\phi_i\cdot ∇_\bfx\phi_j$ can be computed:
\begin{equation*}
  \begin{array}{lll}
    ∇_\bfx\phi_i(\bfx)\cdot ∇_\bfx\phi_j(\bfx) 
    &= \s{k=1}{d} \d{\phi_i(\bfxi)}{x_k}\d{\phi_j(\bfxi)}{x_k} 
    = \s{k=1}{d} \Big(\s{\ell=1}{d}\d{\phi_i(\bfxi)}{\xi_\ell} \d{\xi_\ell(\bfxi)}{x_k} \s{\ell=1}{d}\d{\phi_j(\bfxi)}{\xi_\ell} \d{\xi_\ell(\bfxi)}{x_k} \Big)\\[8mm]
    &= J^{-\top}_\Phi(\bfxi) ∇_{\bfxi} \phi_i(\bfxi) \cdot 
    J^{-\top}_\Phi(\bfxi) ∇_{\bfxi} \phi_j(\bfxi)\\[4mm]
    &= \big(J^{-\top}_\Phi(\bfxi) ∇_{\bfxi} \phi_i(\bfxi)\big)^\top 
    J^{-\top}_\Phi(\bfxi) ∇_{\bfxi} \phi_j(\bfxi)\\[4mm]
    &= ∇_{\bfxi} \phi_i(\bfxi)^\top \ub{J^{-1}_\Phi(\bfxi) 
    J^{-\top}_\Phi(\bfxi)}{=:T_\Phi(\bfxi)} ∇_{\bfxi} \phi_j(\bfxi).
  \end{array}
\end{equation*}
With the definition of the finite element Laplace operator  transformation matrix $T_\Phi(\bfxi) := J^{-1}_\Phi(\bfxi) 
    J^{-\top}_\Phi(\bfxi)$ the transformation becomes:
\begin{equation*}
  \begin{array}{lll}
    ∇_\bfx\phi_i(\bfx)\cdot ∇_\bfx\phi_j(\bfx) = ∇_{\bfxi} \phi_i(\bfxi) \cdot T_\Phi(\bfxi) ∇_{\bfxi} \phi_j(\bfxi).
  \end{array}
\end{equation*}

\textbf{2D case.}
In two dimensions we consider the 2D manifold embedded in $\R^3$ with the mapping $\Phi: [0,1]^2 \to \Omega \subset \R^3$. At a fixed point $\bfp \in \Omega$ with $\Phi(\bfxi_p) = \bfp$ we first determine the tangent vectors $\bfzeta_1(\bfxi_p), \bfzeta_2(\bfxi_z)$. The first tangent vector is defined to lie on the $\xi_1$ coordinate direction, the second vector is then constructed to be orthogonal to the first. To define the tangent vector $\bfzeta_1$ we use a curve in parameter space:
\begin{equation*}
  \begin{array}{lll}
    \gamma(t) = \mat{\gamma_1(t) \\ \gamma_2(t)} = \mat{\xi_{p1}+t \\ \xi_{p2} }.
  \end{array}
\end{equation*}
Then we define
\begin{equation*}
  \begin{array}{lll}
    \bfzeta_1 &= (\Phi \circ \gamma_1)'(0) 
    = \p{t}\Phi\big(\gamma(t)\big)|_{t=0} \\[4mm]
    &= \p{\Phi(\gamma(0))}{\xi_1}\ub{\gamma_1'(t)}{=1} + \p{\Phi(\gamma(0))}{\xi_2}\ub{\gamma_2'(t)}{=0}\\[4mm]
    &= \p{\Phi(\xi_p)}{\xi_1}.
  \end{array}
\end{equation*}
Similar we define the helper tangent vector $\bfzeta_h$ along the $\xi_2$ coordinate, which is then
\begin{equation*}
  \begin{array}{lll}
    \bfzeta_h = \p{\Phi(\xi_p)}{\xi_2}.
  \end{array}
\end{equation*}
$\bfzeta_1$ and $\bfzeta_h$ are not orthogonal in general. Therefore a third tangent vector $\bfzeta_2 = \bfzeta_1\times \bfzeta_h \times \bfzeta_1$ will be defined.

It is the tangent vector of a curve 
\begin{equation*}
  \begin{array}{lll}
    \delta(t) = \mat{\delta_1(t) \\ \delta_2(t)} = \mat{\xi_{p1}+\cos(α)t \\ \xi_{p2}+\sin(α)t }.
  \end{array}
\end{equation*}
The angle $\beta$ between $\bfzeta_1$ and $\bfzeta_h$ is given by
\begin{equation*}
  \begin{array}{lll}
    \cos(\beta) |\bfzeta_1| |\bfzeta_h| = \bfzeta_1 \cdot \bfzeta_h
    \quad \Rightarrow \quad \beta = \arccos\left(\dfrac{\bfzeta_1 \cdot \bfzeta_h}{|\bfzeta_1| |\bfzeta_h|}\right)
  \end{array}
\end{equation*}
Then by relating angles we get
\begin{equation*}
  \begin{array}{lll}
    \dfrac{\pi/2}{\beta} = \dfrac{α}{\pi/2} \quad \Rightarrow \quad \alpha = \dfrac{\pi^2}{4\,\beta}.
  \end{array}
\end{equation*}
So the tangent vector becomes
\begin{equation}\label{eq:tangent_vector}
  \begin{array}{lll}
    \bfzeta_2 = (\Phi \circ \delta)'(0) = \p{\Phi(\bfxi_p)}{\xi_1}\cos(α) + \p{\Phi(\bfxi_p)}{\xi_2}\sin(α) = \bfzeta_1\,\cos(α) + \bfzeta_h\,\sin(α).
  \end{array}
\end{equation}
Another approach is to use the formula 
\begin{equation*}
  \begin{array}{lll}
    \bfzeta_2 = \bfzeta_1\times \bfzeta_h \times \bfzeta_1,
  \end{array}
\end{equation*}
which leads to the expression
\begin{equation*}
  \begin{array}{lll}
    \bfzeta_2 = \mat{
    -\p{\Phi_2}{\xi_1}(\p{\Phi_1}{\xi_1}\p{\Phi_2}{\xi_2} - \p{\Phi_1}{\xi_2}\p{\Phi_2}{\xi_1}) - \p{\Phi_3}{\xi_1}(\p{\Phi_1}{\xi_1}\p{\Phi_3}{\xi_2} - \p{\Phi_1}{\xi_2}\p{\Phi_3}{\xi_1}) \\[4mm]
 \p{\Phi_1}{\xi_1}(\p{\Phi_1}{\xi_1}\p{\Phi_2}{\xi_2} - \p{\Phi_1}{\xi_2}\p{\Phi_2}{\xi_1}) - \p{\Phi_3}{\xi_1}(\p{\Phi_2}{\xi_1}\p{\Phi_3}{\xi_2} - \p{\Phi_2}{\xi_2}\p{\Phi_3}{\xi_1})\\[4mm]
 \p{\Phi_1}{\xi_1}(\p{\Phi_1}{\xi_1}\p{\Phi_3}{\xi_2} - \p{\Phi_1}{\xi_2}\p{\Phi_3}{\xi_1}) + \p{\Phi_2}{\xi_1}(\p{\Phi_2}{\xi_1}\p{\Phi_3}{\xi_2} - \p{\Phi_2}{\xi_2}\p{\Phi_3}{\xi_1})
    }.
  \end{array}
\end{equation*}
The mapping between parameter space and tangent space is given by $\Psi_\bfp$:
\begin{equation*}
  \begin{array}{lll}
    \Psi_\bfp : [0,1]^2 \to T_\bfp\Omega,\\[4mm]
    \Psi_\bfp(\bfxi) = \bfp + c_1(\bfxi)\,\hat{\bfzeta}_1 + c_2(\bfxi)\,\hat{\bfzeta}_2.\\[4mm]
  \end{array}
\end{equation*}
The basis vectors $\hat{\bfzeta}_i$ are the normalized tangent vectors, $\hat{\bfzeta}_i = \bfzeta_i / |\bfzeta_i|$. And the coefficients are:
\begin{equation*}
  \begin{array}{lll}
    c_1(\bfxi) = \big(\xi_1-\xi_{p1}-(\xi_2-\xi_{p2})\cos(α)/\sin(α)\big)\,l_1\\[4mm]
    c_2(\bfxi) = (\xi_2-\xi_{p2})/\sin(α)\,l_2,
  \end{array}
\end{equation*}
with the lengths $l_1 = |\bfzeta_1|, l_2 = |\bfzeta_2|$.

The Jacobian of $\Psi$ and its inverse are as follows:
\begin{equation*}
  \begin{array}{lll}
    J_\Psi = \mat{l_1 & -l_1\,\cos(α)/\sin(α) \\ 0 & l_2/\sin(α)},\qquad
    J_\Psi^{-1} = J_{\Psi^-1} = \mat{1/l_1 & \cos(α)/l_2 \\ 0 & \sin(α)/l_2}.
  \end{array}
\end{equation*}
The inverse contains the entries
\begin{equation*}
  \begin{array}{lll}
    (J^{-1}_{\Psi})_{i,j} = \d{\xi_i}{\zeta_j}.
  \end{array}
\end{equation*}

To compute the gradients of a function with respect to $\zeta$, we use the chain rule:
%
\begin{equation*}
  \begin{array}{lll}
    \d{\phi(\bfxi)}{\zeta_k} = \s{\ell=1}{d}\d{\phi(\bfxi)}{\xi_\ell}\d{\xi_\ell(\bfxi)}{\zeta_k},
  \end{array}
\end{equation*}
so the gradient becomes
\begin{equation*}
  \begin{array}{lll}
    ∇_{\bfzeta} \phi(\bfxi) = J_{\Psi}^{-\top}∇_{\bfxi}\phi(\bfxi),
  \end{array}
\end{equation*}
where $J^{-\top}_{\Psi} = (J_\Psi^{-1})^\top$.

Analogous to the 3D case we define 
\begin{equation*}
  \begin{array}{lll}
    T_\Psi(\bfxi) := J_{\Psi}^{-1}(\bfxi)J_\Psi^{-\top}(\bfxi) = \mat{\cos(α)^2/l_2^2 + 1/l_1^2 & \sin(α)\,\cos(α)/l_2^2 \\ \sin(α)\,\cos(α)/l_2^2 & \sin(α)^2/l_2^2}
  \end{array}
\end{equation*}
and get:
\begin{equation*}
  \begin{array}{lll}
    ∇_{\bfzeta}\phi_i(\bfx)\cdot ∇_{\bfzeta}\phi_j(\bfx) = ∇_{\bfxi} \phi_i(\bfxi) \cdot T_\Phi(\bfxi) ∇_{\bfxi} \phi_j(\bfxi).
  \end{array}
\end{equation*}
%Note that the computational domain $\Omega\subset \R^3$ is always considered to be embedded in $\R^3$. The 1D and 2D cases where the mesh is fully contained within a 1D or 2D subspace are then a specialization of the general case. Think of the lower dimensional meshes as a curve ($d=1$) or a bended surface ($d=2$) embedded in $\R^3$.

\subsection{Evaluation of the integral term}\label{chap:integral1}
The integral in \eqref{eq:fe_integral} defines for $i$ and $j$ the entries $m_{ij}$ of the \emph{stiffness matrix} $M$.
The equation can be written in matrix form as
%
\begin{equation*}
  \begin{array}{lll}
    M\,\bfu = \bfzero,
  \end{array}
\end{equation*}
where $M$ contains the entries
\begin{equation*}
  \begin{array}{lll}
    m_{ij} = -\ds\int_{\Omega}∇\phi_i\cdot ∇\phi_j\,\d\bfx = -\s{e=1}{M} \sum_{i\in N(e)} \ds\int_{[0,1]^d} ∇\phi_i(\bfxi)\cdot T_\Phi(\bfxi)∇\phi_j(\bfxi)\,\mathcal{J}_d(\bfxi)\,\d\bfxi
  \end{array}
\end{equation*}
and $\bfu = (u_1, \dots, u_N)^\top$ is the solution vector. Given $M$ the solution $\bfu$ is computed by an appropriate linear system solver.

The integral for $m_{i,j}$ depends via $\mathcal{J}_d$ on the shape of the elements. In general, it has to be evaluated numerically. However, for special simple cases it can be computed analytically.
This includes scenarios in $d=1,2,3$ dimensions where the elements are on a rectilinear cartesian grid.

If the grid is arbitrary, analytical computation for 1D is still simple. For $d=2,3$ it is still possible, but involves more lengthy derivations that are usually performed using a computer algebra system such as \verb|sympy|. In this section the 1D and 2D cases are derived, the python \verb|sympy| code for 2D and 3D is contained in the \verb|doc| directory for further reference.

For all 1D meshes that are embedded in a 3D domain as well as rectangular cartesian 2D and 3D meshes the terms $T_\Phi(\bfxi)$ and $\mathcal{J}_d(\bfxi)$ are constant within each element, i.e. do not depend on $\bfxi$. In that case we can take $\mathcal{J}_d$ out of the integral.

\textbf{1D case.}
We now compute $m_{ij}$ for $d=1$. The transformation term $\mathcal{J}_1(\xi)$
is defined as
%
\begin{equation*}
  \begin{array}{lll}
    \mathcal{J}_1(\xi) = \Vert \Phi'(\xi)\Vert_2.
  \end{array}
\end{equation*}
Using the parametric representation of $\Phi$ given in \eqref{eq:fe_phi}, we derive
%
\begin{equation*}
  \begin{array}{lll}
    \mathcal{J}_1(\xi) = \Vert \Phi'(\xi)\Vert_2 = \Vert \bfx^2 - \bfx^1 \Vert_2,
  \end{array}
\end{equation*}
which is the length of the element $e$ with nodes $\bfx^1$ and $\bfx^2$. We define it to be $l_e := \Vert\bfx^2-\bfx^1\Vert_2$, and thus have $\mathcal{J}_1(\xi) = l_e$. The scaling factor is then $s = l_e$ and the total prefactor of the integral becomes
\begin{equation*}
  \begin{array}{lll}
    \mathcal{J}_1\,s^{-2} = 1/l_e.
  \end{array}
\end{equation*}



%We use the derivatives of the Lagrange functions,
%\begin{equation}
%  \begin{array}{ll}
%    L_{1,1}'(\xi) = -1, \quad L_{2,1}'(\xi) = 1.\\[4mm]
%  \end{array}
%\end{equation}

\textbf{2D case.}
For 2D we assume a rectangular element that lies in a $z=\text{constant}$ plane with side lengths $l_{1,e}$ and $l_{2,e}$ in $\xi_1$ and $\xi_2$ directions.
The mapping from $\bfxi=(\xi_1,\xi_2)$ to $\bfx$ coordinate frame is given by
\begin{equation}
  \begin{array}{ll}
    \Phi(\bfxi) = \bfx^1 + \mat{\xi_1\,l_{1,e} \\[2mm] \xi_2\,l_{2,e}}.
  \end{array}
\end{equation}
Then we derive
\begin{equation*}
  \begin{array}{lll}
    J_{\Phi}(\bfxi) = \mat{l_{1,e}  & 0 \\[2mm] 0 & l_{2,e}}
  \end{array}
\end{equation*}
and
\begin{equation*}
  \begin{array}{lll}
    \mathcal{J}_2 = \sqrt{\det \big(J_{\Phi}(\bfxi)^\top J_{\Phi}(\bfxi)\big)} = |l_{1,e}\,l_{2,e}|.
  \end{array}
\end{equation*}
The tangent vectors $\bfzeta_1$ and $\bfzeta_h$ are computed to be
\begin{equation*}
  \begin{array}{lll}
    \bfzeta_1 = \p{\Phi(\bfxi_p)}{\xi_1} = (l_{1,e},0)^\top,\quad
    \bfzeta_h = \p{\Phi(\bfxi_p)}{\xi_2} = (0, l_{2,e})^\top,
     \quad l_1 = |\bfzeta_1| = l_{1,e}.
  \end{array}
\end{equation*}
The angle in between is
\begin{equation*}
  \begin{array}{lll}
    \beta = \arccos\left(\dfrac{\bfzeta_1\cdot \bfzeta_h}{|\bfzeta_1||\bfzeta_h|}\right) = \dfrac{\pi}{2}.
  \end{array}
\end{equation*}
The angle in parameter space is then also $\alpha = \pi^2 / (4\beta) = \pi/2$.
Using \eqref{eq:tangent_vector} the orthogonal tangent vector $\bfzeta_2$ becomes $\bfzeta_2 = \bfzeta_h$. Then $l_2 = |\bfzeta_h| = l_{2,e}$.

This leads to a transformation matrix
\begin{equation*}
  \begin{array}{lll}
    T_\Psi(\bfxi) = \mat{\cos(α)^2/l_2^2 + 1/l_1^2 & \sin(α)\,\cos(α)/l_2^2 \\[2mm] \sin(α)\,\cos(α)/l_2^2 & \sin(α)^2/l_2^2} = \mat{1/l_{1,e}^2 & 0 \\[2mm] 0 & 1/l_{2,e}^2}.
  \end{array}
\end{equation*}
When the mesh resolution is uniform, i.e. $l_{1,e} = l_{2,e} = l_e$, the transformation matrix becomes a scaled identity matrix, $T_{\Psi}(\bfxi) = l_e^{-2}\,\bfI$ and the transformation can be moved out of the integral. The prefactor is then
\begin{equation*}
  \begin{array}{lll}
    \mathcal{J}_2\,l_e^{-2} = 1.
  \end{array}
\end{equation*}


\textbf{3D case.}
Similar to the 2D case when a rectangular 3D grid with grid widths $l_{1,e}, l_{2,e},l_{3,e}$ is assumed, the transformation factor becomes
\begin{equation*}
  \begin{array}{lll}
    \mathcal{J}_3 = |l_{1,e}\,l_{2,e}\,l_{3,e}|.
  \end{array}
\end{equation*}
With the world mapping $\Phi(\bfxi)$ and its Jacobian $J_{\Phi}(\bfxi)$ given by
\begin{equation*}
  \begin{array}{lll}
    \Phi(\bfxi) = \bfx^1 + \mat{\xi_1\,l_{1,e}\\[2mm]
    \xi_2\,l_{2,e}\\[2mm]
    \xi_3\,l_{3,e}}
  \end{array}, \quad 
  J_{\Phi}(\bfxi) = \mat{l_{1,e}&0&0 \\[2mm] 0 & l_{2,e} & 0 \\[2mm] 0 & 0 & l_{3,e}},
\end{equation*}
the transformation matrix becomes
\begin{equation*}
  \begin{array}{lll}
    T_\Phi(\bfxi) := J^{-1}_\Phi(\bfxi) 
    J^{-\top}_\Phi(\bfxi) = \mat{l_{1,e}^{-2}&0&0 \\[2mm] 0 & l_{2,e}^{-2} & 0 \\[2mm] 0 & 0 & l_{3,e}^{-2}}.
  \end{array}
\end{equation*}
With uniform grid lengths, $l_{1,e}=l_{2,e}=l_{3,e}=l_e$, we get $T_\Phi(\bfxi) = l_e^{-2}\,\bfI$. The prefactor of the integral yields
\begin{equation*}
  \begin{array}{lll}
    \mathcal{J}_3\,l_e^{-2} = l_e.
  \end{array}
\end{equation*}

In the presented special cases with uniform grid resolution $\mathcal{J}_d$ did not depend on the integration domain, which allows to compute the factor separately:
\begin{equation*}
  \begin{array}{lll}
    \ds\int_{\Omega} ∇\phi_i \cdot T ∇\phi_j\,\mathcal{J}_d\,\d\bfxi = \mathcal{J}_d\,l_e^{-2}\ds\int_{\Omega} ∇\phi_i \cdot ∇\phi_j\,\d\bfxi.
  \end{array}
\end{equation*}

Now the term $-\int ∇\phi_i\cdot ∇\phi_j \,\d\xi$, remains to be computed. We compute values at the nodes and visualize them using \emph{stencil notation}. For a fixed node $i$ we compute the respective values for adjacent nodes $j$. The result for $i=j$ is underlined in the stencil, the values for adjacent nodes are placed left, right, top and bottom, in the position of the respective nodes.

We first compute element-wise stencils that state the contribution of a single element. If all elements have the same length properties, the element contributions can be summed up to get the total value at the nodes which is shown in the nodal stencils. From these stencils we can easily set up the stiffness matrix for a non-varying, equidistant mesh.

\begin{table}[h]
\centering
\begin{tabular}{l|l|l|l}
    dim & element contribution & node stencil\\
    \hline
    1D: &
\begin{minipage}{6cm}
  \begin{equation*}
     \left[\begin{array}{ccc}
        \underline{-1} & 1\\
    \end{array}\right] \quad 
  \end{equation*}
\end{minipage} 
    &
\begin{minipage}{6cm}
  \begin{equation*}
    \left[\begin{array}{ccc}
        1 & \underline{-2} & 1\\
    \end{array}\right]
  \end{equation*}
\end{minipage} 
     \\[4mm]
     \hline
    2D:&
\begin{minipage}{6cm}
  \begin{equation*}
    \left[
      \begin{array}{ccc}
        1/6 & 1/3 \\
        \underline{-2/3} & 1/6
      \end{array}
    \right]
  \end{equation*}
\end{minipage}  &
\begin{minipage}{6cm}
  \begin{equation*}
      \dfrac13\left[
        \begin{array}{ccc}
          1 & 1 & 1\\
          1 & \underline{-8} & 1 \\
          1 & 1 & 1
        \end{array}
      \right]
  \end{equation*}
\end{minipage}  \\[4mm]
    \hline
    3D: &
\begin{minipage}{6cm}
  \begin{equation*}
    \begin{array}{ll}
      \text{center:} &
      \left[\begin{array}{ccc}
          0 & 1/12\\
          \underline{-1/3} & 0\\
      \end{array}\right] \\[4mm]
      \text{top:}& 
      \left[\begin{array}{ccc}
          1/12 & 1/12\\
             0 & 1/12\\
      \end{array}\right]
    \end{array}
  \end{equation*}
\end{minipage} &
\begin{minipage}{6cm}
  \begin{equation*}
    \begin{array}{ll}
      \text{bottom:} &
      \dfrac1{12}
      \left[\begin{array}{ccc}
          1 & 2 & 1\\
          2 & 0 & 2\\
          1 & 2 & 1
      \end{array}\right] \\[4mm]
      \text{center:} &
      \dfrac1{12}
      \left[\begin{array}{ccc}
          2 & 0 & 2\\
          0 & \underline{-32} & 0\\
          2 & 0 & 2
      \end{array}\right] \\[4mm]
      \text{top:}& 
      \dfrac1{12}
      \left[\begin{array}{ccc}
          1 & 2 & 1\\
          2 & 0 & 2\\
          1 & 2 & 1 
      \end{array}\right]
    \end{array}  
  \end{equation*}
\end{minipage}
\end{tabular}
\caption{Stencils of the Finite Element stiffness matrix of $-Δu$ for an equidistant mesh with uniform resolution}
\end{table}

\subsection{Boundary Conditions}
\label{sec:bc}
The Dirichlet-type boundary condition
%
\begin{equation*}
  \begin{array}{lll}
    ∇u(\bfx)\cdot \bfn = 0 \qquad \text{on }\Gamma_N
  \end{array}
\end{equation*}
%
is satisfied automatically by the Galerkin finite element formulation. Starting from the left hand side of \eqref{eq:laplace_weak} and using Divergence theorem we get:
%
\begin{equation*}
  \begin{array}{lll}
    -\i{\Omega}{} ∇u\cdot ∇\phi \,\d \bfx = -\i{∂\Omega}{} \phi\,\big(∇u\cdot \bfn\big) \,\d \bfx + \i{\Omega}{} Δu\,\phi  \,\d \bfx = 0 \qquad ∀ \phi \in H^1_0(\Omega)
  \end{array}
\end{equation*}
%
Because $Δu = 0$ on $\Omega$ we get $∇u\cdot \bfn=0$ on the boundary.

Neumann boundary conditions can be easily considered at the discretized system. For each condition $u_i = u_{0,i}$ that enforces the degree of freedom $i$ to have the value $u_{0,i}$ we modify the linear system of equations. In the  right hand side vector we subtract from the value $f_{j}$ the product of $a_{ji}$ and the given value $u_{0,i}$ for every $j\neq i$, i.e. the new value is $\hat{f_j} = f_j - a_{ji}\,u_{0,i}$. We set $f_i = u_{0,i}$. In the matrix we zero the row and column that contain the entry $a_{ii}$, i.e. $a_{ij} = a_{ji} = 0, ∀j\neq i$ and set $a_{ii}=1$. As an example, consider the system
%
\begin{equation*}
  \begin{array}{lll}
    \mat{m_{11} & m_{12} & m_{13} \\ m_{21} & m_{22} & m_{23} \\ m_{31} & m_{32} & m_{33}}
    \mat{u_1 \\ u_2 \\ u_3} = \mat{0 \\ 0 \\ 0}
  \end{array}
\end{equation*}
with the Dirichlet boundary condition $u_3 = u_{0,3}$. The modified system then reads
%
\begin{equation*}
  \begin{array}{lll}
    \mat{m_{11} & m_{12} & 0 \\ m_{21} & m_{22} & 0 \\ 0 & 0 & 1}
    \mat{u_1 \\ u_2 \\ u_3} = \mat{-m_{13}\,u_{0,3} \\ -m_{23}\,u_{0,3} \\ u_{0,3}}.
  \end{array}
\end{equation*}

\subsection{Function spaces}
\label{sec:hilbert}
%
For the weak solutions $u$ of the problems we do not need to request $\CC^2(\Omega)$, since only the first derivatives are needed and only in a weak sense. Therefore $u\in H^1_0(\Omega)$ suffices.

The Hilbert space $H^1(\Omega)$ is the Sobolev space $\W^{1,2}(\Omega)$ which is defined using weak derivatives. The concept of weak derivatives generalizes the classical derivatives.

Let $u,v\in \Lloc(\Omega)$ and $\alpha \in \N^d_0$ a multi-index. Then $v$ is called \emph{weak derivative} of $u$ of order $\alpha$ iff
\begin{equation}
  \begin{array}{ll}
    \i{\Omega}{}u(\bfx) \D^\alpha \phi(\bfx) \,\d \bfx = (-1)^{|\alpha|} \i{\Omega}{} v(\bfx)\,\phi(\bfx)\,\d \bfx
  \end{array}
\end{equation}
for all $\phi \in \CC^\infty_0(\Omega)$. We then write $\D^\alpha u = v$. The derivative with the multi-index, $\D^\alpha$ is given by
\begin{equation}
  \begin{array}{ll}
    \D^\alpha = \dfrac{\p^{|\alpha|}}{\p^{\alpha_1}_{x_1} \cdots \p^{\alpha_d}_{x_d}}
  \end{array}
\end{equation}

If $u$ is differentable in a classical sense, the classical derivatives are also the weak derivatives. 

Now we define the \emph{Sobolev} space $\W^{1,2}(\Omega)$ (1=first order weak derivatives, 2=derivatives in $\L^2(\Omega)$)) as follows:
\begin{equation}
  \begin{array}{ll}
    \W^{1,2}(\Omega) := \{ u \in \Lloc(\Omega) \mid |\alpha| \in \N^d_0, |\alpha| \leq 1, \D^\alpha u \text{ exists}, \D^\alpha u \in \L^2(\Omega)\}.
  \end{array}
\end{equation}
With an appropriate Sobolev norm, $\W^{1,2}$ is a Banach space, i.e. complete (Cauchy series converge in it).

Together with the scalar product
\begin{equation}
  \begin{array}{ll}
    (u,v)_{H^1} := \sum\limits_{|\alpha|\leq 1} \i{\Omega}{}{\D^\alpha u(\bfx) \,\D^\alpha v(\bfx) \,\d\bfx}
  \end{array}
\end{equation}
we get the Hilbert space $H^1(\Omega) := \W^{1,2}(\Omega)$.

With $H^1_0(\Omega) := \{u \in H^1(\Omega) \mid u(\bfx) = 0 \text{ for } \bfx \in \p \Omega\}$ we denote the subspace of functions that are 0 on the boundary.

%-------------------------------------------------------------------------------------------------

\section{Poisson Equation}
The Poisson equation is a generalization of the Laplace equation and reads
%
\begin{equation*}
  \begin{array}{lll}
    Δu = f\qquad \text{on }\Omega.
  \end{array}
\end{equation*}
%
It can be subject to the same boundary conditions as Laplace equation, i.e. Neumann-type boundary conditions
%
\begin{equation*}
  \begin{array}{lll}
    ∇u(\bfx) \cdot \bfn = 0 \qquad \text{on }\Gamma_N,
  \end{array}
\end{equation*}
%
as well as Dirichlet-type boundary conditions
%
\begin{equation*}
  \begin{array}{lll}
    u(\bfx) = u_0(\bfx) \qquad \text{on }\Gamma_D.
  \end{array}
\end{equation*}
The finite element formulation proceeds similar to Chap.~\ref{chap:laplace}, multiplication of a testfunction $\phi \in H^{1}_0(\Omega)$ and integration yields
\begin{equation*}
  \begin{array}{lll}
    \ds\int_{\Omega}Δu\,\phi\,\d \bfx = \int_{\Omega} f\,\phi\,\d \bfx, \quad \forall \phi \in H^1_0(\Omega).
  \end{array}
\end{equation*}
Applying divergence theorem we get
\begin{equation}\label{eq:poisson_divergence}
  \begin{array}{lll}
    -\ds\int_{\Omega} ∇u\cdot ∇\phi \,\d \bfx = \int_{\Omega} f\,\phi\,\d \bfx \quad \forall \phi \in H^{1}_0(\Omega).
  \end{array}
\end{equation}
Like the solution $u(\bfx)$ also the right hand side $f(\bfx)$ has to be spatially discretized by a linear combination of coefficients and basis functions:
%
\begin{equation*}
  \begin{array}{lll}
    u_h(\bfx) = \s{i=1}{N}u_i\,\phi_i(\bfx),\\[4mm]
    f_h(\bfx) = \s{i=1}{N}f_i\,\phi_i(\bfx).
  \end{array}
\end{equation*}
By again choosing the space of testfunctions to be the same as the span of basis functions, ${V=\span\{\phi_1, \dots, \phi_n\}}$ we get the Galerkin formulation as
\begin{equation*}
  \begin{array}{lll}
    -\s{i=1}{N} u_i \int_\Omega ∇\phi_i\cdot ∇\phi_j \,\d\bfx = \s{i=1}{N}f_i \int_\Omega \phi_i\cdot \phi_j \,\d\bfx \quad \text{for }j = 1, \dots, N.
  \end{array}
\end{equation*}
The domain $\Omega$ is again decomposed into disjoint elements $\Omega_e, e=1,\dots, M$ and integration has only be performed over the elements where none of the basis function vanish.

The first integral term, $\int_{\Omega} ∇\phi_i\cdot ∇\phi_j\,\d\bfx$, has to be computed as described in Section \ref{chap:integral1}. How to compute the second integral term, $\int_{\Omega} \phi_i\cdot \phi_j\,\d\bfx$ is shown in the following.

Similar as before, the integration domain is transferred from element space to parameter space. For this a transformation factor $\mathcal{J}_d$ has to be considered, which is constant for some special cases as discussed in \cref{chap:integral1}.

For the remaining integral, $\int_{\Omega} \phi_i\cdot \phi_j\,\d\bfxi$ node stencils are provided in the following table.

\begin{table}[h]
\centering
\begin{tabular}{l|l|l|l}
    dim & element contribution & node stencil\\
    \hline
    1D: &
\begin{minipage}{6cm}
  \begin{equation*}
     \dfrac16\left[\begin{array}{ccc}
        \underline{2} & 1\\
    \end{array}\right] \quad 
  \end{equation*}
\end{minipage} 
    &
\begin{minipage}{6cm}
  \begin{equation*}
    \dfrac16\left[\begin{array}{ccc}
        1 & \underline{4} & 1\\
    \end{array}\right]
  \end{equation*}
\end{minipage} 
     \\[4mm]
     \hline
    2D:&
\begin{minipage}{6cm}
  \begin{equation*}
    \dfrac1{36}\left[\begin{array}{ccc}
        2 & 1 \\
        \underline{4} & 2
      \end{array}
    \right]
  \end{equation*}
\end{minipage}  &
\begin{minipage}{6cm}
  \begin{equation*}
      \dfrac1{36}\left[
        \begin{array}{ccc}
          1 & 4 & 1\\
          4 & \underline{16} & 4 \\
          1 & 4 & 1
        \end{array}
      \right]
  \end{equation*}
\end{minipage}  \\[4mm]
    \hline
    3D: &
\begin{minipage}{6cm}
  \begin{equation*}
    \begin{array}{ll}
      \text{center:} &
      \dfrac1{216}\left[\begin{array}{ccc}
          4 & 2\\
          \underline{8} & 4\\
      \end{array}\right] \\[4mm]
      \text{top:}& 
      \dfrac1{216}\left[\begin{array}{ccc}
          2 & 1\\
          4 & 2\\
      \end{array}\right]
    \end{array}
  \end{equation*}
\end{minipage} &
\begin{minipage}{6cm}
  \begin{equation*}
    \begin{array}{ll}
      \text{bottom:} &
      \dfrac1{216}\left[\begin{array}{ccc}
          1 & 4 & 1\\
          4 & 16 & 4\\
          1 & 4 & 1
      \end{array}\right] \\[4mm]
      \text{center:} &
      \dfrac1{216}
      \left[\begin{array}{ccc}
          4 & 16 & 4\\
          16 & \underline{64} & 16\\
          4 & 16 & 4
      \end{array}\right] \\[4mm]
      \text{top:}& 
      \dfrac1{216}
      \left[\begin{array}{ccc}
          1 & 4 & 1\\
          4 & 16 & 4\\
          1 & 4 & 1 
      \end{array}\right]
    \end{array}  
  \end{equation*}
\end{minipage}
\end{tabular}
\caption{Stencils of the Finite Element right hand side for an equidistant mesh with uniform resolution}
\end{table}


\section{Generalized Laplace operator}
%
The Laplace equation $Δu=0$ describes steady-state matter-/heat-/current flow where the computed quantity $u$ designates the potential that induces the flow $\bfF$, which can be modelled as being directed against the potential gradient, $\bfF = -∇u$. In terms of heat transfer this is \emph{Fick's law}. By considering the conservation law of the flowing quantity we assume $∇\cdot \bfF = 0$ which leads directly to the Laplace equation. 

If the medium in which the flow occurs is non-isotropic this can be modelled by adjusting the relationship between the negative potential gradient, $-∇u$, and the induced flow direction, $F$. By applying a linear map $A$ onto the negative gradient vector which can be thought of being the sum of contributions in coordinate directions, each contribution vector of a coordinate direction gets scaled and projected to a new direction. The flow is then $\bfF = -AΔu$ and the resulting equation is called generalized Laplace equation, reading
\begin{equation*}
  \begin{array}{lll}
    ∇\cdot (A ∇u) = 0.
  \end{array}
\end{equation*}
The parantheses can also be neglected. $∇\cdot A∇$ is referred to as generalized Laplace operator.

The derivation of the Finite Element formulation proceeds analoguos to \cref{chap:laplace}.
Multiplication with a testfunction $\phi$ yields:
\begin{equation}
  \begin{array}{ll}
    \ds\int_{\Omega}∇\cdot A ∇u\,\phi\,\d \bfx = 0 \quad \forall \phi\in H^1_0(\Omega)
  \end{array}
\end{equation}
Applying divergence theorem \eqref{eq:gauss1} with $f=\phi$ and $\bfF=A ∇u$ yields
\begin{equation}
  \begin{array}{ll}
    -\ds\int_{\Omega}A ∇u \cdot ∇\phi \,\d \bfx + \ds\int_{\p \Omega} (\phi\,A∇u)\cdot\bfn\,\d \bfx  = 0 \quad \forall \phi\in H^1_0(\Omega).
  \end{array}
\end{equation}
Because $\phi$ is zero on the boundary, the boundary integral vanishes:
\begin{equation}\label{eq:laplace_weak}
  \begin{array}{ll}
    -\ds\int_{\Omega}A ∇u \cdot ∇\phi \,\d \bfx = 0 \quad \forall \phi\in H^1_0(\Omega).
  \end{array}
\end{equation}
The discretization remains the same and leads to an integral term of
%
\begin{equation*}
  \begin{array}{lll}
    m_{ij} = -\ds\int_{Ω}A∇\phi_i\cdot ∇\phi_j\,\d\bfx.
  \end{array}
\end{equation*}
for the stiffness matrix $M$. For these term the stencil notation cannot be applied in general. The stiffness matrix has to be computed using e.g. numerical quadrature.

%-------------------------------------------------------------------------------------------------

\section{Diffusion Equation}

The diffusion equation reads
\begin{equation}\label{eq:diffusion}
  \begin{array}{lll}
    u_t = c\,Δu, \qquad c \in \R
  \end{array}
\end{equation}
For the finite element formulation it can be seen as a Poisson equation with right hand side $u_t$, neglecting the constant $c$ for now. 
We get from \eqref{eq:poisson_divergence}:
\begin{equation}\label{eq:diffusion_derivation1}
  \begin{array}{ll}
    -\ds\int_{\Omega} ∇u\cdot ∇\phi \,\d \bfx = \int_{\Omega} u_t\,\phi\,\d \bfx \quad \forall \phi \in H^{1}_0(\Omega).
  \end{array}
\end{equation}
The derivative in time, $u_t$ can be discretized by a differential quotient as follows:
\begin{equation*}
  \begin{array}{lll}
    u_t = \dfrac{u^{(t+1)} - u^{(t)}}{dt},
  \end{array}
\end{equation*}
where $dt$ is the time step width. In space we formulate the quantity again with a discrete basis:
\begin{equation*}
  \begin{array}{lll}
    u_h^{(t)}(\bfx) = \s{i=1}{N} u_i^{(t)}\,\phi_i(\bfx).
  \end{array}
\end{equation*}
Substituting into \eqref{eq:diffusion_derivation1} yields:
\begin{equation*}
  \begin{array}{lll}
    & -\ds\int_{\Omega} ∇u^{(t)}\cdot ∇\phi \,\d \bfx = \dfrac{1}{dt}\int_{\Omega} \Big(u^{(t+1)} - u^{(t)}\Big))\,\phi\,\d \bfx \quad \forall \phi \in H^{1}_0(\Omega)\\[4mm]
    \Leftrightarrow\quad & -\s{i=1}{N} u^{(t)}_i \ds\int_Ω ∇\phi_i \cdot ∇\phi_j\,\d\bfx = \dfrac{1}{dt}\s{i=1}{N}(u_i^{(t+1)} - u_i^{(t)})\ds\int_Ω \phi_i \cdot \phi_j\,\d\bfx\qquad \text{for }j = 1,\dots, N.
  \end{array}
\end{equation*}
In Matrix notation with the stiffness matrix, $\bfK$, and the mass matrix, $\bfM$, and the vectors of the degrees of freedom for time $t$, $u^{t}$, we get:
\begin{equation*}
  \begin{array}{lll}
    -\bfK\bfu = \dfrac1{dt} \bfM\Big(u^{(t+1)} - u^{(t)}\Big).
  \end{array}
\end{equation*}
Solving for $u^{(t+1)}$ yields:
\begin{equation*}
  \begin{array}{lll}
    u^{(t+1)} = u^{(t)} - dt \,\bfM^{-1}\bfK\bfu.
  \end{array}
\end{equation*}
\subsection{Analytical Solution}
The analytical solution to the diffusion equation \eqref{eq:diffusion} makes use of the fundamental solution
\begin{equation*}
  \begin{array}{lll}
    H(x,t) = \dfrac1{\sqrt{4\pi\,c\,t}}\exp\left(-\dfrac{x^2}{4\,c\,t}\right) \quad \text{for 1D}\\[4mm]
    H(\bfx,t) = \dfrac1{(4\pi\,c\,t)^{n/2}}\exp\left(-\dfrac{\Vert \bfx \Vert_2^2}{4\,c\,t}\right) \quad \text{for 2D,3D}\\[4mm]
  \end{array}
\end{equation*}
For $\Omega=\R^d$ and initial condition
\begin{equation*}
  \begin{array}{lll}
    u(\bfx,0) = u_0(\bfx)\qquad \bfx \in \Omega
  \end{array}
\end{equation*}
the solution is
\begin{equation*}
  \begin{array}{lll}
    u(\bfx,t) = \ds\int_{\R^d} H(\bfx - \bfy,t)\,u_0(\bfy)\,\d \bfy.
  \end{array}
\end{equation*}

%------------------------------------------------------------------------------------------------
\section{Multidomain}

Currently not compiled because unpublished.

%
%The multidomain equations generalized the bidomain equation by having multiple compartments at each spatial point. Each compartment $k$ describes one of the $M_\text{mu}$ motor units.
%\begin{equation}
%  \begin{array}{lll}\label{eq:multidomain1}
%    \div\big(\bfsigma_i^k\,\grad(V_m^k + \phi_e)\big) = A_m^k\,\big(C_m^k\,\p{V_m^k}{t} + I_\text{ion}(V_m^k)\big) \qquad \forall\,k \in 1\dots M_\text{mu}
%  \end{array}
%\end{equation}
%\begin{equation}\label{eq:multidomain2}
%  \begin{array}{lll}
%    \div\big(\bfsigma_e\,\grad(\phi_e)\big) + \s{k=1}{M_\text{mu}} f_i^k\,\div\big(\bfsigma_i^k\,\grad(V_m^k + \phi_e)\big) = 0 \qquad\forall\,k \in 1\dots M_\text{mu}\\[4mm]
%  \end{array}
%\end{equation}
%The unknowns are the transmembrane voltages, $V_m^k$ and the extracellular potential, $\phi_e$. $f_i^k \in [0,1]$ is a spatially varying factor of the presence of the compartment.
%$\bfsigma_i^k$ and $\bfsigma_e$ are the conductivity tensors of the fibres and extracellular space.
%
%Solving \eqref{eq:multidomain1} for $∂V_m^k/∂t$ yields:
%\begin{equation*}
%  \begin{array}{lll}
%    \p{V_m^k}{t} = \dfrac{1}{A^k_m\,C_m^k}\div\big(\bfsigma_i^k\,\grad(V_m^k + \phi_e)\big) - \dfrac{1}{C_m^k}\,I_\text{ion}(V_m^k)
%  \end{array}
%\end{equation*}
%
%The bidomain equation is used for computation of EMG:
%\begin{equation*}
%  \begin{array}{lll}
%    \div\big((\bfsigma_i + \bfsigma_e)\,\grad \phi_e\big) = - \div(\bfsigma_i\,\grad V_m)
%  \end{array}
%\end{equation*}

%------------------------------------------------------------------------------------------------
\section{Structural mechanics}
The order in this section may be a bit confusing or lacking transition texts. It should be seen more as a collection of the theory and formulas.

In this section the Einstein sum convention is used.

\subsection{Introduction of some quantities}
No quantities that are completely defined in the actual configuration are considered. $\bfF$ maps between configurations, $\bfS, \bfC, \bfeps$ are completely in the reference configuration.
The definitions are briefly listed here.
\begin{itemize}
\item[$\bullet$] Polar decomposition of deformation gradient $\bfF$:
\begin{equation*}
  \begin{array}{lll}
    \bfF = \bfR\,\bfU, \quad \bfR^\top\bfR = \bfI, \quad \bfU = \bfU^\top \,\text{positive definite}
  \end{array}
\end{equation*}
$\bfR$ rotation tensor, $\bfU$ right stretch tensor, $\det \bfU = \det \bfF = J > 0$.
%
\item[$\bullet$] Right Cauchy-Green tensor $\bfC = \bfF^\top \bfF$, symmetric, positive definite, $\det \bfC = J^2 > 0$.
\item[$\bullet$] Left Cauchy-Green tensor $\bfb = \bfF\bfF^\top$, symmetric, positive definite, $\det \bfb = J^2 > 0$.
\item[$\bullet$] Green-Lagrange strain tensor $\bfeps = \bfE =\dfrac12(\bfC - \bfI)$, symmetric (Both symbols are used here, because of literature). Note that the computation of $\bfeps$ from a vector of displacement DOFs is nonlinear.
\item[$\bullet$] 2nd Piola-Kirchhoff stress tensor $\bfS = \p{\Psi(\bfE)}{\bfE} = 2\p{\psi(\bfC)}{\bfC}$, not symmetric.
\end{itemize}

\subsection{Green-Lagrange strain tensor and derivatives}

In this subsection quantities of the reference configuration are denoted by left superscript ${}^o{\cdot}$, quantities in the current configuration at time $t$ are denoted by left superscript ${}^t{\cdot}$. Derivation with respect to the reference configuration are denoted by ${}^{t}_o{\cdot}$.

The position of a material point $i$ at time $t$ is given by
\begin{equation*}
  \begin{array}{lll}
    {}^tx_i = {}^ox_i + {}^tu_i,
  \end{array}
\end{equation*}
where ${}^ox_i$ is the position in reference configuration and ${}^tu_i$ is the displacement. The deformation gradient $\bfF$ is defined by the entries
\begin{equation*}
  \begin{array}{lll}
    F_{ij} = {}^t_ox_{i,j} = \p{{}^tx_i}{{}^ox_j}.
  \end{array}
\end{equation*}
The subscript comma means differentiation. We have ${}^t_ox_{i,j} = \delta_{ij} + u_{i,j}$. 
The discretization of $^{t}u$ reads
\begin{equation*}
  \begin{array}{lll}
    {}^tu_i(x) = \phi_L(x)\,{}^tu_i^L,
  \end{array}
\end{equation*}
where ${}^tu_i^L$ are the coefficients, i.e. the nodal displacements. Lower case indices $i,j,k,\dots$ refer to component indices $\{1,2,3\}$, capital indices are for dofs $\{1,\dots,n\}$. 
The symbol ${}^tu_i^L$ stands for the nodal degree of freedom $L$ of the displacement component $i\in \{1,2,3\}$.

Differentiation yields
\begin{equation*}
  \begin{array}{lll}
    {}^t_ox_{i,j} = \p{{}^tx_i}{{}^ox_j} = \delta_{ij} + \p{{}^tu_i}{{}^ox_j} = \delta_{ij} + \phi_{L,j}(x)\,{}^tu_i^L = \delta_{ij} + u_{i,j}.
  \end{array}
\end{equation*}
The Green-Lagrange strain tensor ${}^t_o\bfeps$ is defined as 
\begin{equation*}
  \begin{array}{lll}
    {}^t_o \bfeps_{kl} = \dfrac12\big({}^t_ox_{b,k}\,{}^t_ox_{b,l} - \delta_{kl}\big).
  \end{array}
\end{equation*}
Next the derivative with respect to a nodal displacement $u_i^L$ is considered. Therefore we need
\begin{equation*}
  \begin{array}{lll}
    \p{{}^t_ox_{i,j}}{u^L_k} = \p{\phi_L\,{}^tu_i^L}{u^L_k} = \phi_{L,j}\,\delta_{ik}.
  \end{array}
\end{equation*}
We then proceed to compute
\begin{equation*}
  \begin{array}{lll}
    \p{{}^t_o\bfeps_{kl}}{u^L_i} = \dfrac12\Big(\p{{}^t_ox_{b,k}}{u^L_i}\,{}^t_ox_{b,l} + {}^t_ox_{b,k}\,\p{{}^t_ox_{b,l}}{u^L_i}\Big) = \dfrac12\Big( \phi_{L,k}\,\delta_{bi} \,{}^t_ox_{b,l} + {}^t_ox_{b,k}\, \phi_{L,l}\,\delta_{bi}\Big) = \dfrac12\Big( {}^t_ox_{i,l}\,\phi_{L,k} + {}^t_ox_{i,k}\, \phi_{L,l}\Big).
  \end{array}
\end{equation*}
We compute the second derivative (results from \cite{SUSSMAN1987357})
\begin{equation*}
  \begin{array}{lll}
   \dfrac{\p ^t_o\bfeps_{kl}}{\p u^L_i\,\p u^M_j} = \dots = \frac12\big(\phi_{L,k}\,\phi_{M,l} + \phi_{L,l}\,\phi_{M,k}\big)\,\delta_{ij}.
  \end{array}
\end{equation*}

\subsection{Solid mechanics derivation}

For incompressible and nearly incompressible analyses it is necessary to use a mixed formulation to avoid convergence problems (locking). \cite{zienkiewicz1977finite}, \cite{bathe2006finite}

The first subsection formulates the classical mixed formulation that is used for compressible / nearly incompressible analyses.

\subsubsection{Mixed formulation}

The following description is completely in reference configuration (material description).

The stress and strain tensors are split into deviatoric and volumetric parts.
Decomposition of strain tensor $\bfeps$ into volumetric strain $\eps_\text{vol}$ and deviatoric strain $\bfeps_\text{dev}$.
\begin{equation*}
  \begin{array}{lll}
    \bfeps = \bfeps_{dev} + \dfrac13 \eps_\text{vol}\bfI, \qquad \bfeps_{ij} = \bfeps_{\text{dev},ij} + \dfrac13\eps_\text{vol}\,\delta_{ij},
  \end{array}
\end{equation*}
where the volumetric strain is then
\begin{equation*}
  \begin{array}{lll}
    \eps_\text{vol} = \tr(\bfeps), \qquad \eps_\text{vol} = \bfeps_{kk},
  \end{array}
\end{equation*}
the deviatoric strain is
\begin{equation*}
  \begin{array}{lll}
    \bfeps_{dev} = \bfeps -  \dfrac13 \eps_\text{vol}\bfI,\qquad   \bfeps_{\text{dev},ij} = \bfeps_{ij} - \dfrac13\,\eps_\text{vol}\,\delta_{ij}.
  \end{array}
\end{equation*}

For the stress we define
\begin{equation}\label{eq:sdev_def}
  \begin{array}{lll}
    \bfS_\text{dev} = \bfS + p\,\bfI, \qquad \bfS_{\text{dev},ij} = \bfS_{ij} + p\,\delta_{ij}
  \end{array}
\end{equation}

The pressure $p$ is positive in compression, whereas strains are positive in expansion, therefore the minus sign.
\begin{equation*}
  \begin{array}{lll}
    p = -\dfrac13\,\tr(\bfS), \qquad p = -\dfrac13\,\bfS_{kk}
  \end{array}
\end{equation*}

The relation between pressure $p$ and volumetric strain $\eps_\text{vol}$ is modeled by a linear relationship with constant $\kappa$,
\begin{equation*}
  \begin{array}{lll}
    p = -\kappa \eps_\text{vol},
  \end{array}
\end{equation*}
where $\kappa$ is the bulk modulus and is expressed in terms of Lamé parameters, $E$ and $\nu$, as follows:
\begin{equation*}
  \begin{array}{lll}
    \kappa = \dfrac{E}{3(1-2ν)}
  \end{array}
\end{equation*}
Incompressibility is reached for $\nu \to 0.5$ respective $\kappa\to\infty$.


The Principle of Virtual Work states in general:
\begin{equation*}
  \begin{array}{lll}
    \ds\int_{\Omega} \delta\bfeps : \bfS\,\d V = W_\text{ext}
  \end{array}
\end{equation*}

The right-hand side $W_\text{ext}$ is the external virtual work
\begin{equation*}
  \begin{array}{lll}
    W_\text{ext} = \ds\int_{\Omega} \delta \bfu^\top \bff_B\,\d V + \ds\int_{\Gamma_f} \delta \bfu_{\Gamma_f}^{\top} \bff_{\Gamma_f}\,\d S
  \end{array}
\end{equation*}
with:
\begin{equation*}
  \begin{array}{lll}
    \bfu: \quad & \text{displacements}\\[4mm]
    \bff_B: \quad & \text{body force (force per unit volume)}\\[4mm]    
    \bff_{\Gamma_f}: \quad &\text{surface traction on surface $\Gamma_f$}
  \end{array}
\end{equation*}

For mixed formulation where pressure and deviatoric stress are both unknown variables, the principle of virtual work is formulated as
\begin{equation}\label{eq:mixed_eq1}
  \begin{array}{lll}
    \ds\int_{\Omega} \delta \bfeps_\text{dev} : \bfS_\text{dev} \,\d V - \ds\int_{\Omega} \delta \eps_\text{vol}\,p \,\d V = W_\text{ext}.
  \end{array}
\end{equation}

Because there are now two independent variables, $p$ and $\bfS_{dev}$ we need the second equation to establish the connection.
\begin{equation}\label{eq:mixed_eq2}
  \begin{array}{lll}
    \ds\int_{\Omega} \left(\dfrac1{\kappa}p + \eps_\text{vol}\right)\delta p\,\d V = 0
  \end{array}
\end{equation}

\subsubsection{Linear elasticity}

The constitutive relation between strain, given by the two parts, volumetric $\bfeps_\text{vol}$ and deviatoric $\bfeps_\text{dev}$ and stress $\bfS$ is assumed to be the linear relationship
\begin{equation*}
  \begin{array}{lll}
    \bfS_{ij} = \kappa\,\bfeps_\text{vol}\,\delta_{ij} + 2\,G\,\bfeps_{\text{dev},ij}
  \end{array}
\end{equation*}
with the constants
\begin{equation*}
  \begin{array}{lll}
    G = \dfrac{E}{2(1+ν)}: \quad &\text{shear modulus}\\[4mm]
    \kappa = \dfrac{E}{3(1-2ν)} \quad &\text{bulk modulus (incompressible: $κ\to\infty$).}
  \end{array}
\end{equation*}

We can express the constitutive relation in the form
\begin{equation*}
  \begin{array}{lll}
    \bfS = \bfD\,\bfeps, \quad \bfS_\text{dev} = \bfD_\text{dev}\,\bfeps_\text{dev}
  \end{array}
\end{equation*}
where $\bfD$, $\bfD_\text{dev}$ is an appropriate material tensor.

We discretize the displacement and strain using the vector of DOFs, $\hat{\bfu}$,
\begin{equation*}
  \begin{array}{lll}
    \bfu = \bfN\,\hat{\bfu}, \quad \bfeps_\text{dev}= \bfB_\text{dev}\,\hat{\bfu}, \quad \bfeps_\text{vol} = \bfB_\text{vol}\,\hat{\bfu}.
  \end{array}
\end{equation*}
This formula for the strain which is linear in the DOFs is not possible for general 3D descriptions, as for $\eps = 1/2 (\bfF^\top \bfF-\bfI)$ we have a quadratic dependence in the displacement then. However for beam elements and 1D elements it is valid, also for assumption of small strains and displacements.

Also the pressure is discretized independently,
\begin{equation*}
  \begin{array}{lll}
    p = \bfN_p\,\hat{\bfp}.
  \end{array}
\end{equation*}

From \eqref{eq:mixed_eq1} and \eqref{eq:mixed_eq2} we get the matrix formulation of the problem,
\begin{equation*}
  \begin{array}{lll}
    \left[\begin{array}{cc}
      \bfK_{uu} & \bfK_{up}\\[2mm]
      \bfK_{up}^\top & \bfK_{pp}
    \end{array}\right]
    \left[\begin{array}{c}
      \hat{\bfu}\\[2mm]
      \hat{\bfp}
    \end{array}\right] = 
    \left[\begin{array}{c}
      \bfR\\[2mm]
      \bfzero,
    \end{array}\right] 
  \end{array}
\end{equation*}
where
\begin{equation*}
  \begin{array}{lll}
    \bfK_{uu} = \ds\int_{\Omega} \bfB_\text{dev}^\top \bfD_\text{dev} \,\bfB_\text{dev} \,\d V,\\[4mm]
    \bfK_{up} = -\ds\int_{\Omega} \bfB_\text{vol}^\top \bfN_p \,\d V,\\[4mm]
    \bfK_{pp} = -\ds\int_{\Omega} \bfN_p^\top\dfrac1{\kappa} \bfN_p \,\d V.
  \end{array}
\end{equation*}
For completely incompressible material behaviour we replace $1/\kappa$ by $0$ and have
\begin{equation*}
  \begin{array}{lll}
    \left[\begin{array}{cc}
      \bfK_{uu} & \bfK_{up}\\[2mm]
      \bfK_{up}^\top & \bfzero
    \end{array}\right]
    \left[\begin{array}{c}
      \hat{\bfu}\\[2mm]
      \hat{\bfp}
    \end{array}\right] = 
    \left[\begin{array}{c}
      \bfR\\[2mm]
      \bfzero,
    \end{array}\right]
  \end{array}
\end{equation*}

\subsection{Finite elasticity}

\bild{tonti_diagram}{0.8\textwidth}{Tonti diagram}

A nonlinear case occurs if the constitutive relation between $\bfS$ and $\bfeps$ is nonlinear or if the relationship between displacement $\bfu$ and strain $\bfeps$ is nonlinear, as depicted in the Tonti diagram, \cref{fig:tonti_diagram}.

The case of 3D finite elasticity the relation between the displacement vector $\hat{\bfu}$ and the strain $\bfE = (\bfC - \bfI)/2$ is nonlinear because of $\bfC = \bfF^\top \bfF$. In addition the material model is often nonlinear, because of the invariants. 

Starting point for the derivation of the governing equations is again the Principle of Virtual Work in mixed formulation, \eqref{eq:mixed_eq1} and \eqref{eq:mixed_eq2}.

The variation of a strain quantity $\bfeps$, that is discretized by a vector of displacement degrees of freedom, $\hat{\bfu}$ is computed as
\begin{equation*}
  \begin{array}{lll}
    \delta \bfeps = \left(\p{\eps}{\hat{\bfu}} \right)^\top \delta\hat{\bfu} = \delta\hat{\bfu}^\top\,\left(\p{\eps}{\hat{\bfu}} \right).
  \end{array}
\end{equation*}
We discretize the pressure $p$ by linear combination of ansatz functions, stored in the vector $\bfN_p$ with the coefficients $\hat{\bfp}$ being the degrees of freedom.
\begin{equation*}
  \begin{array}{lll}
    p = \bfN_p^\top \hat{\bfp}
  \end{array}
\end{equation*}

Plugging this into \eqref{eq:mixed_eq1} and together with a general material formulation $\bfS(\hat{\bfu})$, we get for the virtual internal work:
\begin{equation}\label{eq:Wint}
  \begin{array}{lll}
    \delta W_\text{int} = \delta \hat{\bfu}^\top \left(\ds\int_{\Omega} \p{\bfeps_\text{dev}}{\hat{\bfu}} : \bfS_\text{dev}(\hat{\bfu}) \,\d V - \ds\int_{\Omega} \p{\eps_\text{vol}}{\hat{\bfu}}\,\bfN_p^\top \hat{\bfp} \,\d V\right)
  \end{array}
\end{equation}
or in index notation
\begin{equation*}
  \begin{array}{lll}
    \delta W_\text{int} = \delta\hat{\bfu}_i \left(\ds\int_{\Omega} \p{\bfeps_{\text{dev},jk}}{\hat{\bfu}_i} \bfS_{\text{dev},jk}(\hat{\bfu}) \,\d V - \ds\int_{\Omega} \p{\eps_\text{vol}}{\hat{\bfu}_{i}}\,\bfN_{p,j} \hat{\bfp}_j \,\d V\right)
  \end{array}
\end{equation*}
The external virtual work can be written as
\begin{equation}\label{eq:Wext}
  \begin{array}{lll}
    \delta W_\text{ext} = \delta\hat{\bfu}^\top \left(\ds\int_{\Omega} \bff_{B}\,\d V + \ds\int_{\Gamma_f}  \bff_{\Gamma_f}\,\d S\right),
  \end{array}
\end{equation}
where the force vectors $\bff_B$ and $\bff_{\Gamma_f}$ are of same size as $\hat{\bfu}$ and contain the appropriate entries (consistent nodal forces).
 
The resulting equation of the form
\begin{equation*}
  \begin{array}{lll}
    \delta W_\text{int} + \delta W_\text{ext} = 0
  \end{array}
\end{equation*}
can now with \eqref{eq:Wint} and \eqref{eq:Wext} be written as
\begin{equation*}
  \begin{array}{lll}
    \delta\hat{\bfu}^\top \ub{
      \ds\int_{\Omega} \p{\bfeps_\text{dev}(\hat{\bfu})}{\hat{\bfu}} : \bfS_\text{dev}(\hat{\bfu}) \,\d V - \ds\int_{\Omega} \p{\eps_\text{vol}(\hat{\bfu})}{\hat{\bfu}}\, \bfN_p^\top \hat{\bfp} \,\d V 
      + \ds\int_{\Omega} \bff_{B}\,\d V + \ds\int_{\Gamma_f}  \bff_{\Gamma_f}\,\d S 
    }{=:\bfR_1(\hat{\bfu},\hat{\bfp})} = 0
  \end{array}
\end{equation*}
The strain tensors $\eps_\text{dev}$ and $\eps_\text{vol}$ can be computed nonlinearly from $\hat{\bfu}$.

The second equation that connects to the pressure $p$ is \eqref{eq:mixed_eq2}. It contains the variation of the pressure, $\delta p$ which is resolved as follows
\begin{equation*}
  \begin{array}{lll}
    \delta p = \bfN_p^\top \delta \hat{\bfp}.
  \end{array}
\end{equation*}
Using the pressure degrees of freedom, $\hat{\bfp}$, we have:
\begin{equation*}
  \begin{array}{lll}
    &\ds\int_{\Omega} \ub{\left(\dfrac1{\kappa}\,\bfN_p^\top \hat{\bfp} + \eps_\text{vol}(\hat{\bfu})\right)}{\in \R} \bfN_p^\top \delta \hat{\bfp} \,\d V = 0\\[4mm]
    \Leftrightarrow \quad & \delta \hat{\bfp}^\top  \ub{\ds\int_{\Omega}  \bfN_p \left(\dfrac1{\kappa}\,\bfN_p^\top \hat{\bfp} + \eps_\text{vol}(\hat{\bfu})\right)\,\d V}{=:\bfR_2(\hat{\bfu},\hat{\bfp})} = 0
  \end{array}
\end{equation*}

This nonlinear set of equations has now to be solved for the degrees of freedom ${(\hat{\bfu}, \hat{\bfp})}$.
\begin{equation*}
  \begin{array}{lll}
    \mat{\bfR_1(\hat{\bfu},\hat{\bfp}) \\[4mm]
    \bfR_2(\hat{\bfu},\hat{\bfp})} = \bfzero
  \end{array}
\end{equation*}
For simplified notation the unknows are describes by a single vector $\bfw = (\hat{\bfu}, \hat{\bfp})$ and the equations by $\bfR(\bfw) = (\bfR_1(\bfw), \bfR_2(\bfw))$.

The Newton-Raphson scheme linearizes the equations around iterative values $\bfw^{(k)}$.
\begin{equation*} 
  \begin{array}{lll}
    \bfR(\bfw^{(k+1)}) = \bfR\Big|_{\bfw=\bfw^{(k)}} + \d{\bfR(\bfw)}{\bfw}\Big|_{\bfw=\bfw^{(k)}} \ub{\big(\bfw^{(k+1)}-\bfw^{(k)}\big)}{=:Δ\bfw^{(k)}} + \O\big((\bfw^{(k+1)}-\bfw^{(k)})^2\big).
  \end{array}
\end{equation*}
The iterative procedure starts with a start value $\bfw^{(0)} = \bfw_0$ and repeats to compute ${\bfw^{(k+1)} = \bfw^{(k)} + Δ\bfw^{(k)}}$. The increment $Δ\bfw^{(k)}$is computed by assuming $\bfR(\bfw^{(k+1)}) = 0$ and solving
\begin{equation*}
  \begin{array}{lll}
    \d{\bfR(\bfw)}{\bfw}\Big|_{\bfw=\bfw^{(k)}} Δ\bfw^{(k)} = -\bfR(\bfw^{(k)}).
  \end{array}
\end{equation*}
This is a linear system that has to be solved. It is repeated until the residual norm $\Vert \bfR(\bfw^{(k)}) \Vert$ gets below a threshold.
 
The Jacobian, $\mathrm{d} \bfR(\bfw) / \mathrm{d} \bfw$ has the following form:
\begin{equation*}
  \begin{array}{lll}
    \d{\bfR(\bfw)}{\bfw} =
    \mat{
      \p{\bfR_1(\hat{\bfu}, \hat{\bfp})}{\hat{\bfu}} & \p{\bfR_1(\hat{\bfu}, \hat{\bfp})}{\hat{\bfp}}\\[4mm]
      \p{\bfR_2(\hat{\bfu}, \hat{\bfp})}{\hat{\bfu}} & \p{\bfR_2(\hat{\bfu}, \hat{\bfp})}{\hat{\bfp}}
    }
  \end{array}
\end{equation*}
The terms are listed in the following. The first term has to be computed by
\begin{equation*}
  \begin{array}{lll}
    \p{\hat{\bfu}} \bfR_1(\hat{\bfu}, \hat{\bfp}) &= \p{\hat{\bfu}}\left( 
    \ds\int_{\Omega} \p{\bfeps_\text{dev}(\hat{\bfu})}{\hat{\bfu}} : \bfS_\text{dev}(\hat{\bfu}) \,\d V - \ds\int_{\Omega} \p{\eps_\text{vol}(\hat{\bfu})}{\hat{\bfu}}\, \bfN_p^\top \hat{\bfp} \,\d V 
      + \ds\int_{\Omega} \bff_{B}\,\d V + \ds\int_{\Gamma_f}  \bff_{\Gamma_f}\,\d S
    \right)\\[4mm]
    \p{\hat{\bfu}_j} \bfR_{1,i}(\hat{\bfu}, \hat{\bfp}) &= 
    \ds\int_{\Omega} \dfrac{∂^2\bfeps_{\text{dev},kl}}{∂\hat{\bfu}_i\,∂\hat{\bfu}_j} \bfS_{\text{dev},kl} + 
    \dfrac{∂\bfeps_{\text{dev},kl}}{∂\hat{\bfu}_i} \p{\bfS_{\text{dev},kl}}{\hat{\bfu}_j}\,\d V 
    - \ds\int_{\Omega} \dfrac{∂^2\eps_\text{vol}}{∂\hat{\bfu}_i\,∂\hat{\bfu}_j}\, \bfN_{p,k} \hat{\bfp}_k \,\d V.
  \end{array}
\end{equation*}
The second term is:
\begin{equation*}
  \begin{array}{lll}
    \p{\hat{\bfp}} \bfR_1(\hat{\bfu}, \hat{\bfp}) &= \p{\hat{\bfp}}\left( 
    \ds\int_{\Omega} \p{\bfeps_\text{dev}(\hat{\bfu})}{\hat{\bfu}} : \bfS_\text{dev}(\hat{\bfu}) \,\d V - \ds\int_{\Omega} \p{\eps_\text{vol}(\hat{\bfu})}{\hat{\bfu}}\, \bfN_p^\top \hat{\bfp} \,\d V 
      + \ds\int_{\Omega} \bff_{B}\,\d V + \ds\int_{\Gamma_f}  \bff_{\Gamma_f}\,\d S
    \right)\\[4mm]
    \p{\hat{\bfp}_j} \bfR_{1,i}(\hat{\bfu}, \hat{\bfp}) &= 
    - \ds\int_{\Omega} \dfrac{∂\eps_\text{vol}}{∂\hat{\bfu}_i}\, \bfN_{p,j} \,\d V
  \end{array}
\end{equation*}
Note that $\bfS_{\text{dev}}(\hat{\bfu})$ was defined in \eqref{eq:sdev_def} as 
\begin{equation*}
  \begin{array}{lll}
    \bfS_\text{dev} = \bfS + p\,\bfI = \bfS + \big(\tr (\bfS)\big)\,\bfI.
  \end{array}
\end{equation*}
This $p$ is different from the discretized degrees of freedom $\hat{\bfp}$, because it is derived via the constitutive relation $\bfS(\hat{\bfu})$ from the displacement degrees of freedom, $\hat{\bfu}$, whereas $\hat{\bfp}$ are separate degrees of freedom.
Therefore we have
\begin{equation*}
  \begin{array}{lll}
    \p{\bfS_\text{dev}}{\hat{\bfp}} = 0.
  \end{array}
\end{equation*}

The third term is:
\begin{equation*}
  \begin{array}{lll}
    \p{\hat{\bfu}} \bfR_2(\hat{\bfu}, \hat{\bfp}) &= \p{\hat{\bfu}}\left( 
    \ds\int_{\Omega}  \bfN_p \left(\dfrac1{\kappa}\,\bfN_p^\top \hat{\bfp} + \eps_\text{vol}(\hat{\bfu})\right)\,\d V
    \right)\\[4mm]
    \p{\hat{\bfu}_j} \bfR_{2,i}(\hat{\bfu}, \hat{\bfp}) &= 
    \ds\int_{\Omega}  \bfN_{p,i} \p{\eps_\text{vol}}{\hat{\bfu}_j}\,\d V \quad\text{(? - reformulate with minus sign, cmp. to $∂\bfR_{1,i}/∂\hat{\bfp_j}$)}
  \end{array}
\end{equation*}
 
The fourth term is:
\begin{equation*}
  \begin{array}{lll}
    \p{\hat{\bfp}} \bfR_2(\hat{\bfu}, \hat{\bfp}) &= \p{\hat{\bfp}}\left( 
    \ds\int_{\Omega}  \bfN_p \left(\dfrac1{\kappa}\,\bfN_p^\top \hat{\bfp} + \eps_\text{vol}(\hat{\bfu})\right)\,\d V
    \right)\\[4mm]
    \p{\hat{\bfp}_j} \bfR_{2,i}(\hat{\bfu}, \hat{\bfp}) &= 
    \ds\int_{\Omega}  \bfN_{p,i} \dfrac1{\kappa}\,\bfN_{p,j}\,\d V
  \end{array}
\end{equation*}

For completely incompressible material we set $1/\kappa = 0$ and get 
\begin{equation*}
  \begin{array}{lll}
    \p{\hat{\bfp}} \bfR_2(\hat{\bfu}, \hat{\bfp}) = \bfzero.
  \end{array}
\end{equation*}

 
\subsection{Dynamic elasticity}

Governing equation
\begin{equation*}
  \begin{array}{lll}
    \bfM\,\ddot{\bfu} + \bfC\,\dot{\bfu} + \bfK\,\bfu - \bff = \bfzero
  \end{array}
\end{equation*}
with
\begin{equation*}
  \begin{array}{lll}
    \bfM_{ij} = \ds\int_{\Omega} \bfN_i^\top \rho \bfN_j \,\d V: \quad &\text{mass matrix, density $\rho$}\\[4mm]
    \bfC_{ij} = \ds\int_{\Omega} \bfN_i^\top \bfmu \bfN_j \,\d V: &\text{damping matrix, viscosity parameters $\bfmu$}
  \end{array}
\end{equation*}
(Zienkiewicz I p.470)

Solve with \emph{leap frog}.


\subsection{Material modeling}

\subsubsection{Principal invariants}
The principal scalar invariants of the right Cauchy Green Tensor $\bfC = \bfF^\top\bfF$ are defined as
\def\tr{\mathrm{tr}}
\begin{equation*}
  \begin{array}{lll}
    I_1(\bfC) = \tr(\bfC) = \bfC : \bfI = C_{ii} = λ_1 + λ_2 + λ_3\\[4mm]
    I_2(\bfC) = \dfrac12\Big(\big(\tr(\bfC)^2 - \tr(\bfC^2)\big)\Big) = \dfrac12(C_{ii}\,C_{jj} - C_{ji}\,C_{ij}) = λ_1\,λ_2 + λ_1\,λ_2 + λ_2\,λ_3\\[4mm]
    I_3(\bfC) = \det(\bfC) = ε_{ijk}\,C_{1i}\,C_{2j}\,C_{3k} = λ_1\,λ_2\,λ_3
  \end{array}
\end{equation*}
The principal stretches $\lambda_a, a=1,2,3$ are the eigenvalues of the right Cauchy-Green tensor $\bfC$. $ε_{ijk}$ is the Levi-Civita symbol
\begin{equation*}
  \begin{array}{lll}
    ε_{ijk} = \begin{cases}
      1\quad & \text{for }(i,j,k) \in \{(1,2,3), (2,3,1), (3,1,2)\}\\[2mm]
      -1 \quad  & \text{for } (i,j,k) \in \{(3,2,1), (1,3,2), (2,1,3)\}\\[2mm]
      0 \quad & \text{else}
    \end{cases}
  \end{array}
\end{equation*}


\subsubsection{Strain energy density function}
Strain energy density function $\Psi(\bfC) = \Psi(I_1, I_2, I_3)$ for isotropic hyperelastic materials. To compute $\bfS = 2\,\p{\Psi(\bfC)}{\bfC}$ derivatives w.r.t. to the invariants are required. (p. 216 Holzapfel Nonlinear Solid Mechanics  \cite{holzapfel2000nonlinear})
\begin{equation*}
  \begin{array}{lll}
    \p{I_1}{\bfC} = \p{\tr\bfC}{\bfC} = \p{\bfI:\bfC}{\bfC} = \bfI, \quad &\p{I_1}{C_{AB}} = \delta_{AB}\\[4mm]
    \p{I_2}{\bfC} = \tr C\,\bfI - \bfC, \quad &\p{I_2}{C_{AB}} = I_1\,\delta_{AB} - C_{AB}\\[4mm]
    \p{I_3}{\bfC} = I_3\,\bfC^{-1}, \quad &\p{I_3}{C_{AB}} = I_3\,C^{-1}_{AB}
  \end{array}
\end{equation*}
In total we get
\begin{equation*}
  \begin{array}{lll}
    \bfS &=  \p{\Psi(\bfE)}{\bfE} = 2\,\p{\Psi(\bfC)}{\bfC} = \ds\s{a=1}{3}\p{\Psi}{I_a}\p{I_a}{\bfC}\\[4mm]
     &= 2\left(\left(\p{\Psi}{I_1} + I_1\,\p{\Psi}{I_2}\right)\,\bfI - \p{\Psi}{I_2}\bfC + I_3\,\p{\Psi}{I_3} \,\bfC^{-1}\right)
  \end{array}
\end{equation*}
Useful:
\begin{equation*}
  \begin{array}{lll}
    \left( \p{\bfA^{-1}}{\bfA} \right)_{ijkl} = -\dfrac12(A^{-1}_{ik}\,A^{-1}_{lj} + A^{-1}_{il}\,A^{-1}_{kj})
  \end{array}
\end{equation*}
\subsection{Elasticity tensor}
For the solution of the nonlinear problem the elasticity tensor $\bbC$ has to be computed (Holzapfel p.261  \cite{holzapfel2000nonlinear}):
\begin{equation*}
  \begin{array}{lll}
    \bbC &= \p{\bfS}{\bfE} = 2\p{\bfS}{\bfC} = 4\dfrac{\partial^2\Psi(I_1,I_2,I_3)}{\p\bfC\p\bfC}\\[4mm]
     &= \delta_1\,\bfI \otimes \bfI + \delta_2\,(\bfI \otimes \bfC + \bfC \otimes \bfI) + \delta_3 ( \bfI \otimes \bfC^{-1} + \bfC^{-1} \otimes \bfI)\\[4mm]
     &\quad +  \delta_4 \bfC \otimes \bfC + \delta_5(\bfC \otimes \bfC^{-1} + \bfC^{-1}\otimes \bfC) \\[4mm]
     & \quad + \delta_6 \bfC^{-1} \otimes \bfC^{-1} + \delta_7 \bfC^{-1} \odot \bfC^{-1} + \delta_8\,\bbI
  \end{array}
\end{equation*}
The coefficients $\delta_1, \dots \delta_8$ are defined by
\begin{equation*}
  \begin{array}{lll}
    \delta_1 = 4\left(\dfrac{\partial^2\Psi}{\p I_1 \p I_1} + 2\,I_1\,\dfrac{\partial^2\Psi}{\p I_1 \p I_2} + \p{\Psi}{I_2} + I_1^2\,\dfrac{\partial^2\Psi}{\p I_2 \p I_2} \right),\\[4mm]
    \delta_2 = -4\left(\dfrac{\partial^2\Psi}{\p I_1 \p I_2} + I_1\,\dfrac{\partial^2\Psi}{\p I_2 \p I_2}\right),\\[4mm]
    \delta_3 = 4\left(I_3\,\dfrac{\partial^2\Psi}{\p I_1 \p I_3} + I_1\,I_3\,\dfrac{\partial^2\Psi}{\p I_2 \p I_3}\right), \qquad \delta_4 = 4\,\dfrac{\partial^2\Psi}{\p I_2 \p I_2},\\[4mm]
    \delta_5 = -4\,I_3\,\dfrac{\partial^2\Psi}{\p I_2 \p I_3}, \qquad \delta_6 = 4\left(I_3\p{\Psi}{I_3} + I_3^2\dfrac{\partial^2\Psi}{\p I_3 \p I_3}\right),\\[4mm]
    \delta_7 = -4\,I_3\,\p{\Psi}{I_3}, \qquad \delta_8 = -4\,\p{\Psi}{I_2}.
  \end{array}
\end{equation*}
The elasticity tensor $\bbC$ has the following symmetries:
\begin{equation*}
  \begin{array}{lll}
    \bbC_{ijrs} = \bbC_{rsij}\quad \bbC{ijrs} = \bbC{jirs} = \bbC{ijsr} = \bbC{jisr}
  \end{array}
\end{equation*}
The 21 unique entries are:
\begin{equation*}
  \begin{array}{lll}
    \bbC_{ijrs} \text{ with } (i,j,r,s) =\\[4mm]
    (1,1,1,1),
    (1,2,1,1),
    (1,3,1,1),
    (2,2,1,1),
    (2,3,1,1),
    (3,3,1,1),\\[4mm]
    (1,2,1,2),
    (1,3,1,2),
    (2,2,1,2),
    (2,3,1,2),
    (3,3,1,2),\\[4mm]
    (1,3,1,3),
    (2,2,1,3),
    (2,3,1,3),
    (3,3,1,3),\\[4mm]
    (2,2,2,2),
    (2,3,2,2),
    (3,3,2,2),\\[4mm]
    (2,3,2,3),
    (3,3,2,3),\\[4mm]
    (3,3,3,3)\\[4mm]
  \end{array}
\end{equation*}

\subsection{Constitutive Equations}
\subsubsection{Incompressible Mooney-Rivlin}
The \emph{Mooney-Rivlin} model is used which for incompressible material defines the strain energy function as
\begin{equation*}
  \begin{array}{lll}
    \Psi_\text{Mooney-Rivlin}(I_1, I_2) = c_1(I_1 - 3) + c_2(I_2 - 3),
  \end{array}
\end{equation*}
where $I_1, I_2$ are the strain invariants and $c_1, c_2$ are material parameters.

For incompressible materials the strain energy function is defined as
\begin{equation*}
  \begin{array}{lll}
    \Psi = \Psi_\text{Mooney-Rivlin}(I_1, I_2) - \dfrac12 p\,(I_3-1) 
  \end{array}
\end{equation*}
and the stress as 
\begin{equation*}
  \begin{array}{lll}
    \bfS &= 2\dfrac{∂}{∂\bfC}\Psi_\text{Mooney-Rivlin}(I_1,I_2) - \dfrac{∂\big(p(I_3 - 1)\big)}{∂\bfC} = -p\bfC^{-1} + 2\left(\p{\Psi}{I_1} + I_1\,\p{\Psi}{I_2}\right)\bfI - 2\p{\Psi}{I_2}\bfC\\[4mm]
    &= -p\bfC^{-1} + 2\,\big(c_1 + \,\tr(\bfC)\,c_2\big)\,\bfI - 2\,c_2\,\bfC
  \end{array}
\end{equation*}
The Cauchy stress:
\begin{equation*}
  \begin{array}{lll}
    \bfsigma &= -p\bfI + 2\left(\p{\Psi}{I_1} + I_1\,\p{\Psi}{I_2}\right)\bfb - 2\,\p{\Psi}{I_2}\,\bfb^2\\[4mm]
             &= -p\bfI + 2(c_1 + I_1\,c_2)\,\bfb - 2\,c_2\,\bfb^2\\[4mm]
    \bfsigma &= -p\,\bfI + 2\,c_1\,\bfb - 2\,c_2\,\bfb^{-1}\quad \text{with Left Cauchy-Green tensor }\bfb = \bfF\,\bfF^\top\quad (\text{p.238 Holzapfel})\\[4mm]
             %&= -p\,\bfI + 2\,c_1\,\bfb - 2\,c_2\,I_3^{-1}\big(\bfb^2 - I_1\,\bfb + I_2\,\bfI)\big)\\[4mm]
    %\bfb^2 &= I_1\,\bfb - I_2\,\bfI + I_3\,\bfb^{-1}\quad \Rightarrow\quad \bfb^{-1} = I_3^{-1}\big(\bfb^2 - I_1\,\bfb + I_2\,\bfI)\big)
    \bfb^2 &= \bfb\,\bfb = \bfF\,\bfF^\top\,\bfF\,\bfF^\top, \quad 
      \bfb_{ij}^2 = \bfb_{ik}\bfb_{kj} = \bfF_{il}\,\bfF_{lk}^\top\,\bfF_{km}\,\bfF^\top_{mj} = \bfF_{il}\,\bfF_{kl}\,\bfF_{km}\,\bfF_{jm} 
  \end{array}
\end{equation*}
(Holzapfel p.224 \cite{holzapfel2000nonlinear})

The parameter $p$ is here an indeterminate Lagrange multiplier that is identified as the hydrostatic pressure. However it has to be computed from the equilibrium equations and boundary conditions.

\subsubsection{Compressible Mooney-Rivlin}

\begin{equation*}
  \begin{array}{lll}
    \Psi(J,I_1,I_2) = c(J-1)^2 - d\,\ln J + c_1(I_1 - 3) + c_2(I_2 - 3), \qquad d = 2(c_1 + 2\,c_2)
  \end{array}
\end{equation*}
(Holzapfel p.247 \cite{holzapfel2000nonlinear})

The stress tensor follows by derivation
\begin{equation*}
  \begin{array}{lll}
    \bfS &= 2\p{\Psi}{\bfC} = 2(c_1 + c_2\,I_1)\bfI - 2\,c_2\,\bfC + (2\,c\,J\,(J-1)-d)\bfC^{-1}\\[4mm]
    &= 2(c_1 + c_2\,\tr{\bfC})\bfI - 2\,c_2\,\bfC + \Big(2\,c\,\det(\bfF)\,\big(\det(\bfF)-1\big)-d\Big)\bfC^{-1}\\[4mm]
  \end{array}
\end{equation*}

Alternative model:
\begin{equation*}
  \begin{array}{lll}
    \Psi = \dfrac12 \kappa (J - 1)^2 + c_1(\bar{I_1} - 3) + c_2(\bar{I_2} - 3)
  \end{array}
\end{equation*}
(\cite{SUSSMAN1987357} Sussmann, Bathe p.15)

\subsubsection{Transversely isotropic formulation}

This formulation assumes a ground matrix and fibres with direction $\bfa_0$ in reference configuration. Two pseudo-invariants $I_4(\bfC, \bfa_0), I_5(\bfC, \bfa_0)$ are introduced:
\begin{equation*}
  \begin{array}{lll}
    I_4(\bfC, \bfa_0) = \bfa_0\cdot \bfC\,\bfa_0,\\[4mm]
    I_5(\bfC, \bfa_0) = \bfa_0\cdot\bfC^2\,\bfa_0.
  \end{array}
\end{equation*}
The strain energy function is then stated as
\begin{equation*}
  \begin{array}{lll}
    \Psi = \Psi\big(I_1(\bfC), I_2(\bfC), I_3(\bfC), I_4(\bfC, \bfa_0), I_5(\bfC, \bfa_0)\big)
  \end{array}
\end{equation*}
For the formulation of the stress, derivatives of the pseudo-invariants w.r.t $\bfC$ are needed:
\begin{equation*}
  \begin{array}{lll}
    \p{I_4}{\bfC} = \bfa_0 \otimes \bfa_0, \qquad & \p{I_4}{C_{ij}} = a_{0,i}\,a_{0,j},\\[4mm]
    \p{I_5}{\bfC} = \bfa_0 \otimes \bfC\,\bfa_0 + \bfa_0\,\bfC \dyad \bfa_0, \qquad &\p{I_5}{C_{ij}} = a_{0,i}\,C_{jk}\,a_{0,k} + a_{0,j}\,C_{ik}\,a_{0,k}.
  \end{array}
\end{equation*}

\subsubsection{Reduced Quantities}

For compressible materials reduced quantities are used. The deformation gradient and right Cauchy-Green tensor are multiplicatively decomposed into a volume-changing (volumetric, dilational) and volume-preserving (isochoric, distortional, deviatoric) part as follows:
\begin{equation*}
  \begin{array}{lll}
    \bfF = (J^{1/3}\bfI)\,\bar{\bfF},\\[4mm]
    \bfC = (J^{2/3}\bfI)\,\bar{\bfC}.
  \end{array}
\end{equation*}
The volume preserving measures are given by
\begin{equation*}
  \begin{array}{lll}
    \bar{\bfF} = J^{-1/3}\,\bfF \quad \dots &\text{modified deformation gradient}\\[4mm]
    \bar{\bfC} = J^{-2/3}\,\bfC \quad \dots& \text{modified right Cauchy-Green tensor}
  \end{array}
\end{equation*}
The volume-changing deformations are associated with $J^{1/3}\bfI$ and $J^{2/3}\bfI$.

The strain-enery function is now given in a decoupled representation as
\begin{equation*}
  \begin{array}{lll}
    \Psi(\bfC) = \Psi(J) + \Psi_\text{dev}(\bar{\bfC}).
  \end{array}
\end{equation*}
This leads to volumetric and deviatoric/isochoric contribution of stresses
\begin{equation*}
  \begin{array}{lll}
    \bfS = 2\p{\Psi(\bfC)}{\bfC} = \bfS_\text{vol} + \bfS_\text{dev},\\[4mm]
    \bfS_\text{vol} = 2\p{\Psi_\text{vol}(J)}{\bfC} = J\,p\,\bfC^{-1}\\[4mm]
    \bfS_\text{dev} = 2\p{\Psi_\text{dev}(\bar{\bfC})}{\bfC} = J^{-2/3}\,\mathbb{P} : \bar{\bfS} \qquad \text{(see Holzapfel p.229 \cite{holzapfel2000nonlinear} for definition of $\mathbb{P}$)}\\[4mm]
    p = \d{\Psi_\text{vol}(J)}{J}, \quad \bar{\bfS} = 2\,\p{\Psi_\text{dev}(\bar{\bfC})}{\bar{\bfC}}
  \end{array}
\end{equation*}

\subsection{Formulation in current configuration}

The following spatial quantities are defined in the current configuration.
\begin{equation*}
  \begin{array}{lll}
    \bfx \quad \dots \, &\text{position}\\
    \bfv = \dot{\bfx} \quad \dots \, &\text{velocity}\\
    \rho \quad \dots\, & \text{density}\\
    \bfsigma \quad \dots \, &\text{Cauchy stress}
  \end{array}
\end{equation*}

The connection from the symmetric Cauchy stress tensor $\bfsigma$ to the 2nd Piola-Kirchhoff stress tensor $\bfS$ is given by 
\begin{equation*}
  \begin{array}{lll}
    \bfsigma = J^{-1}\bfF\,\bfS\,\bfF^\top\\[4mm]
    \bfS = J\,\bfF^{-1}\,\bfsigma\,\bfF^{-\top}
  \end{array}
\end{equation*}

(Holzapfel \cite{holzapfel2000nonlinear} p. 135) 
From the \emph{conservation of mass} we get the spatial equation
\begin{equation*}
  \begin{array}{lll}
    \dot{\rho}(\bfx,t) + \rho(\bfx,t)\,∇\cdot \bfv(\bfx,t)  = 0
  \end{array}
\end{equation*}
which for constant density, $\rho$, reduces to
\begin{equation*}
  \begin{array}{lll}
    ∇\cdot \bfv(\bfx,t) = 0.
  \end{array}
\end{equation*}

(Holzapfel \cite{holzapfel2000nonlinear} p. 145) 
From the \emph{balance of linear momentum} the equations of motion in spatial description can be derived.
\begin{equation}\label{eq:linmom}
  \begin{array}{lll}
    \div \bfsigma + \bfb = \rho\,\dot{\bfv}
  \end{array}
\end{equation}

The \emph{balance of angular momentum} enforces the Cauchy stress tensor, $\bfsigma$ to be symmetric (Holzapfel \cite{holzapfel2000nonlinear} p. 147).
\begin{equation*}
  \begin{array}{lll}
    \bfsigma = \bfsigma^\top
  \end{array}
\end{equation*}

\Cref{eq:linmom} can be restated in terms of the displacement $\bfu$ as
\begin{equation*}
  \begin{array}{lll}
    \rho\,\ddot{\bfu} - ∇_\bfx \cdot \bfsigma = 0,\\[4mm]
    ∇_\bfx\cdot \dot{\bfu} = 0.
  \end{array}
\end{equation*}

For the quasi-static case, $\dot{\bfu} = 0$, this reduces to
\begin{equation*}
  \begin{array}{lll}
    ∇_\bfx\cdot \bfsigma = 0.
  \end{array}
\end{equation*}
Substituting the Cauchy stress $\bfsigma$ for the material configuration stress, $\bfS$, yields
\begin{equation*}
  \begin{array}{lll}
    ∇_\bfx\cdot (J^{-1}\,\bfF\,\bfS\,\bfF^\top) = 0
  \end{array}
\end{equation*}
 
%------------------------------------------------------------------------------------------------
\section{Quadrature}

The aim is to compute a good approximation for the integral
%
\begin{equation*}
  \begin{array}{lll}
    I := \i{0}{1}f(\xi)\,\d \xi
  \end{array}
\end{equation*}
with a low number of function evaluations $f(\xi)$. 
\subsection{Gaussian quadrature}
The Gaussian quadrature rule approximates the integral by
%
\begin{equation*}
  \begin{array}{lll}
    I \approx \s{i=1}{n}f(\xi_i)\,w_i
  \end{array}
\end{equation*}
with appropriate \emph{Gauss points} $\xi_i$ and weights $w_i, i=1,\dots,n$. The sampling points and weights are chosen such that the rule approximates polynomials of degree $p_\text{exact}=2\,n-1$ exactly. Some values are listed below. 

\begin{table}[ht]
\centering
\begin{tabular}{c|c|c|c}
    $n$& $\xi_i$& $w_i$ & $p_\text{exact}$\\[4mm]
    \hline&&\\[-4mm]
    $1$& $\dfrac12$ & $1$ & $1$\\[4mm]
    \hline
    $2$& $\pm \dfrac{1+\sqrt{3}}{2\sqrt{3}}$ & $\dfrac12$ & $3$\\[4mm]
    \hline
    $3$& $\dfrac12$ & $\dfrac49$ & $5$ \\[4mm]
     & $\pm \dfrac{\sqrt{3}+\sqrt{5}}{2\sqrt{5}}$ & $\dfrac{5}{18}$ &
\end{tabular}
\caption{Gauss points and weights}
\end{table}

Note: Literature on Gauss quadrature often describes the case of an integral $\int_{-1}^{1} f(x) \,\d x$. The transformation reads:
%
\begin{equation*}
  \begin{array}{lll}
    \i{0}{1} f(\xi) \,\d \xi = \dfrac12 \i{-1}{1} f\big(1/2+x/2\big) \,\d x.
  \end{array}
\end{equation*}

\subsection{Clenshaw-Curtis quadrature}
Clenshaw-Curtis quadrature approximates the function by a number of Chebyshev polynomials for which the exact integral is known.
The function $f$ is evaluated at the $n+1$ roots of the Chebyshev polynomial $T_{n+1}$, which are:
\begin{equation*}
  \begin{array}{lll}
    \xi_i = \cos(i\pi/n), \quad i = 0,\dots,n, \,n \text{ even}.
  \end{array}
\end{equation*}
The function can be written as Chebyshev series
%    
\begin{equation*}
  \begin{array}{lll}
    f(\xi) = \dfrac{a_0}{2} T_0(\xi) + \s{i=1}{∞} a_i\,T_i(x)
  \end{array}
\end{equation*}
where the coefficients result from discrete cosine transform. The approximated integral is computed by
\begin{equation*}
  \begin{array}{lll}
    I \approx a_0 + \s{i=1}{n/2-1} \dfrac{2\,a_{2\,i}}{1-(2\,i)^2} + \dfrac{a_n}{1-n^2}.
  \end{array}
\end{equation*}
The coefficients are
%
\begin{equation*}
  \begin{array}{lll}
    a_{2\,i} = \dfrac{2}{n}\Bigg(\dfrac{f(1)+f(-1)}{2} + f(0)\,(-1)^i + \s{i=1}{n/2-1}\big(f(\xi_i) + f(-\xi_i)\big)\cos(k/2\,\xi_i)\Bigg)
  \end{array}
\end{equation*}

This quadrature rule approximates polynomials with degree $p_\text{exact} = m-1$ exactly when using $m$ sampling points. However for some non-polynomial functions its accuracy may be better than the respective Gauss quadrature.

%------------------------------------------------------------------------------------------------
\section{Propositions}
In this section some propositions are collected such that they can be referenced when needed.

\subsection{Divergence theorem}
\textit{Also called Gauss's theorem.}
Let $U \subset \R^d$ be a compact set with a piecewise smooth boundary $\p U$, $\bfF: U \to \R^d$ a continuously differentiable vector field. Then:
\begin{equation}\label{eq:gauss}
  \begin{array}{ll}
    \ds\int_U ∇\cdot\bfF(\bfx) \,\d \bfx = \ds\int_{\p U} \bfF(\bfx)\cdot \bfn\,\d \bfx.
  \end{array}
\end{equation}
For $d=2$ one gets \emph{Stoke's theorem}.

\subsubsection{Corollary}
Replacing $\bfF$ of \eqref{eq:gauss} by ${f\,\bfF}$ yields the following proposition:

For a differentable function $f: U \to \R$ and a vector field $\bfF: U \to \R^d$ it holds:
\begin{equation}\label{eq:gauss1}
  \begin{array}{ll}
     \ds\int_U f(∇\cdot\bfF) \,\d \bfx = \ds\int_{\p U} (f\,\bfF)\cdot\bfn\,\d \bfx -\ds\int_U \bfF \cdot ∇f \,\d \bfx
  \end{array}
\end{equation}
Now set $\bfF\equiv (1,0,\dots), (0,1,\dots), \dots$ to get the following vector-valued identity:

For a differentable function $f: U \to \R$ it holds:
\begin{equation}
  \begin{array}{ll}
    \ds\int_U ∇f(\bfx) \,\d \bfx = \ds\int_{\p U} f(\bfx)\,\bfn\,\d \bfx
  \end{array}
\end{equation}

\subsection{Classical Stoke's theorem}
Let $U\subset \R^3$ be an open set, $V$ a 2-manifold in $U$ with boundary $\p V$ and $\bfF: U \to \R^3$ a continuously differentiable vector field. Then:
\begin{equation}
  \begin{array}{ll}
    \ds\varointctrclockwise_{\p V} \bfF\cdot\d s = \ds\int_{V} \big(∇\times \bfF\big) \cdot \bfn \,\d\bfx,
  \end{array}
\end{equation}
where $\bfn$ is the normal on the surface $V$.

\subsection{Integration on manifolds}
In the following it is outlined how to integrate on 1D and 2D domains that are embedded in $\R^d$. The formalism of manifolds is omitted for simplicity.

\subsubsection{1D curve integrals}
Let $U\subset \R$ be an open set (the parameter space) and $\Phi:U \to \R^d$ a smooth mapping that defines a curve $\Omega=\Phi(U)$ embedded in $\R^d$. An integrable function $g:\Omega \to \R$ can then be integrated as follows:
%
\begin{equation}\label{eq:integration_transformation_1d}
  \begin{array}{ll}
    \ds\int_{\Phi(U)} g(\bfx) \,\d\bfx = \int_{U} g\big(\Phi(\xi)\big)\,\Vert \Phi'(\xi)\Vert_2 \, \d \xi
  \end{array}
\end{equation}


\subsubsection{2D surface integrals}
Let $U \subset \R^2$ be an open set (parameter space), $\Phi:U \to \Phi(U)=:\Omega \subset\R^3$ a diffeomorphism, $\Phi$ maps parameters $\bfxi=(\xi_1,\xi_2) \in U$ to points in world space $\bfx \in \Omega$. The inverse map $\Phi^{-1} : \Omega \subset \R^3 \to \R^2$ assigns coordinates $(\xi_1,\xi_2)$ to each point $\bfx\in\Omega$. We name $\Phi^{-1}(\bfx) = (x(\bfx),y(\bfx))$ in the following formula. The integration of a 2-dimensional function $g:\Omega \to \R$ is performed as follows.
%
\begin{equation}\label{eq:integration_transformation_2d}
  \begin{array}{ll}
    \ds\int_{\Phi(U)} g(\bfx) \,\d\bfx  
    &  = \ds\int_{U} g\big(\Phi(\bfxi)\big) 
    \sqrt{\det \big(J_{\Phi}(\bfxi)^\top J_{\Phi}(\bfxi)\big)}\,\d\bfxi\\[4mm]
    
    & = \ds\int_{U} g\big(\Phi(\bfxi)\big) 
    \sqrt{\det\mat{\d{\Phi}{\xi_1} \cdot \d{\Phi}{\xi_1} & \d{\Phi}{\xi_1} \cdot \d{\Phi}{\xi_2}  \\[4mm]
    \d{\Phi}{\xi_1} \cdot \d{\Phi}{\xi_2} & \d{\Phi}{\xi_2} \cdot \d{\Phi}{\xi_2}}}\,\d\bfxi\\[4mm]
    
     & = \ds\int_{U} g\big(\Phi(\bfxi)\big) 
    \sqrt{\Big\Vert \d{\Phi}{\xi_1}\Big\Vert_2^2\,\Big\Vert \d{\Phi}{\xi_2}\Big\Vert_2^2 - \Big(\d{\Phi}{\xi_1} \cdot \d{\Phi}{\xi_2}\Big)^2 }\,\d\bfxi\\[4mm]
    
    
  \end{array}
\end{equation}

\subsubsection{Substitution on domains with same dimensionality}
\emph{Integration by substitution}, \textit{German \say{Transformationssatz}}, also \emph{change of variables rule}.
Let $U \subset \R^d$ be an open set, $\Phi:U \to \Phi(U) \subset\R^d$ a diffeomorphism ($\Phi$ bijective and continuously differentiable, inverse map $\Phi^{-1}$ also continuously differentiable).

Then $g:\Phi(U) \to \R$ is integrable on $\Phi(U)$ if and only if the function $\bfxi \mapsto g(\Phi(\bfxi))\,|\det(J_{\Phi}(\bfxi))|$ is integrable on $U$. It holds:
\begin{equation}\label{eq:integration_transformation_3d}
  \begin{array}{ll}
    \ds\int_{\Phi(U)} g(\bfx)\,\d \bfx = \ds\int_U g(\Phi(\bfxi))\,|\det(J_{\Phi}(\bfxi))|\,\d \bfxi,
  \end{array}
\end{equation}
where $J_{\Phi}$ is the Jacobian of $\Phi$.

\subsubsection{Summary}
The transformation rules \cref{eq:integration_transformation_1d,eq:integration_transformation_2d,eq:integration_transformation_3d} can be summarized in a unified form as follows.

Let $U \subset \R^d, d\in\{1,2,3\}$ be an open set (parameter space), $\Phi:U \to \Phi(U)=:\Omega \subset\R^d$ a diffeomorphism that maps parameters $\bfxi \in U$ to points in world space $\bfx \in \Omega$. A function defined in parameter space, $f:U\to \R$, can then be integrated as follows in world space.
%
\begin{equation}\label{eq:integration_transformation_dd}
  \begin{array}{lll}
    \ds\int_{\Phi(U)} f\big(\Phi^{-1}(\bfx)\big)\,\d \bfx = \ds\int_U f(\bfxi)\,\mathcal{J}_d(\bfxi)\,\d \bfxi,
  \end{array}
\end{equation}
where the definition of $\mathcal{J}_d(\bfxi)$  depends on the dimension $d$ as follows:
%
\begin{equation*}
  \begin{array}{rll}
    \mathcal{J}_1(\xi) &= \Vert \Phi'(\xi) \Vert_2 &\quad \text{for }d=1, \bfxi=\xi \in U \subset \R,\\[4mm]
    \mathcal{J}_2(\bfxi) &= \sqrt{\det \big(J_{\Phi}(\bfxi)^\top J_{\Phi}(\bfxi)\big)} &\quad \text{for }d=2, \bfxi\in U \subset \R^2, \phi^{-1}(\bfx) =: \big(x(\bfx), y(\bfx)\big),\\[4mm]
    \mathcal{J}_3(\bfxi) &= |\det (J_{\Phi}\big(\bfxi)\big)| &\quad \text{for }d=3, \bfxi\in U \subset \R^3.
  \end{array}
\end{equation*}

% -------------- Literaturseite --------------------
\newpage
\bibliography{literatur}{}
\bibliographystyle{abbrv}

% -------------- Anhang ------------
%\appendix
%\input{8_anhang.tex}

\end{document}
